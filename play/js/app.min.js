"use strict";
/*!
 * Copyright (c) 2008-2011, www.redips.net All rights reserved.
 * Code licensed under the BSD License: http://www.redips.net/license/
 * http://www.redips.net/javascript/drag-and-drop-table-content/
 * Version 5.0.5
 * Dec 27, 2012.
 */
function BonusesLayout(){var n=this;n.boardm=[];n.init=function(t,i,r){var f,o,h,s,c,l,a,u,e,v;for(n.bx=t,n.by=i,u=0;u<t;++u)for(n.boardm[u]=[],e=0;e<i;++e)n.boardm[u][e]=0;f=Math.floor(t/2);o=Math.floor(i/2);switch(r){case"Classic":for(n.q(3,0,1),n.q(6,2,1),n.q(0,3,1),n.q(f,3,1),n.q(2,6,1),n.q(6,6,1),n.q(3,o,1),n.q(5,1,2),n.q(1,5,2),n.q(5,5,2),u=1;u<5;++u)n.q(u,u,3);n.q(0,0,4);n.q(f,0,4);n.q(0,o,4);break;case"WWF":for(u=2,e=1;u<f;u+=2)n.q(u,e,1),n.q(e,u,1),e*=2;n.q(6,0,2);n.q(3,3,2);n.q(5,5,2);n.q(0,6,2);n.q(5,1,3);n.q(f,3,3);n.q(1,5,3);n.q(3,o,3);n.q(3,0,4);n.q(0,3,4);break;case"Basketball":for(n.q(6,0,1),n.q(3,1,1),n.q(1,3,1),n.q(0,6,1),u=0;u<f;++u)n.q(u,o,1),n.q(f,u,1);n.q(4,1,2);n.q(2,2,2);n.q(1,4,2);n.q(f,0,3);n.q(3,3,3);n.q(4,4,3);n.q(4,5,3);n.q(5,6,3);n.q(0,o,3);n.q(5,0,4);n.q(0,5,4);break;case"Flower Garden":for(h=[4,2,3,1],u=0,s=0;u<t;u+=2){for(e=0;e<i;e+=2)n.boardm[u][e]=h[s++],s===h.length&&(s=0);--s==-1&&(s=h.length-1)}break;case"Heart":n.m(2,1,1);n.m(4,1,1);n.m(0,4,1);n.m(0,6,1);n.m(1,8,1);n.m(3,10,1);n.m(6,13,1);n.boardm[3][3]=1;n.boardm[2][4]=1;n.m(5,1,2);n.m(1,2,2);n.m(0,7,2);n.m(4,11,2);n.m(3,1,3);n.m(6,2,3);n.m(0,3,3);n.m(2,9,3);n.m(5,12,3);n.boardm[4][3]=3;n.boardm[3][4]=3;n.boardm[2][5]=3;n.m(7,3,4);n.m(0,5,4);n.m(7,14,4);break;case"Mario Star":n.m(f,0,1);n.m(5,3,1);n.m(1,4,1);n.m(3,4,1);n.m(1,6,1);n.m(6,6,1);n.m(6,o,1);n.m(3,8,1);n.m(2,10,1);n.m(1,12,1);n.m(2,14,1);n.m(f,11,1);n.m(6,1,2);n.m(4,4,2);n.m(6,5,2);n.m(6,11,2);n.m(4,13,2);n.m(1,14,2);n.m(5,2,3);n.m(2,4,3);n.m(0,5,3);n.m(2,7,3);n.m(3,9,3);n.m(2,11,3);n.m(2,11,3);n.m(5,12,3);n.m(1,13,3);n.m(3,14,3);n.m(0,4,4);n.m(5,o,4);n.m(5,8,4);n.m(6,8,4);break;case"PokÃ© Ball":for(n.q(6,0,1),n.q(3,1,1),n.q(1,3,1),n.q(f,5,1),u=0;u<6;++u)n.q(u,o,1);n.q(4,1,2);n.q(2,2,2);n.q(1,4,2);n.q(f,0,3);n.q(6,5,3);n.q(0,6,3);n.q(5,6,3);n.q(2,o,3);n.q(5,0,4);n.q(0,5,4);break;case"Smiley":n.q(6,0,1);n.q(2,2,1);n.q(0,6,1);n.m(4,4,1);n.m(5,4,1);n.m(4,5,1);n.m(4,6,1);n.m(5,6,1);n.m(6,11,1);n.q(3,1,2);n.q(1,3,2);n.m(5,5,2);n.m(4,10,2);n.q(f,0,3);n.q(4,1,3);n.q(1,4,3);n.q(0,o,3);n.m(3,9,3);n.m(5,11,3);n.m(7,11,3);n.q(5,0,4);n.q(0,5,4);break;case"Snowflake":n.q(4,2,1);n.q(2,4,1);n.q(f,3,1);n.q(f,5,1);n.q(3,o,1);n.q(5,o,1);n.boardm[6][0]=1;n.boardm[8][14]=1;n.q(4,4,2);n.q(6,6,2);n.boardm[14][6]=2;n.boardm[0][8]=2;n.q(3,3,3);n.q(5,5,3);n.boardm[8][0]=3;n.boardm[14][8]=3;n.boardm[6][14]=3;n.boardm[0][6]=3;n.q(f,1,4);n.q(2,2,4);n.q(1,o,4);break;case"Yin Yang":for(u=5;u<9;++u)n.boardm[u][1]=1;for(u=3;u<10;++u)n.boardm[u][2]=1;for(u=2;u<11;++u)n.boardm[u][3]=1,n.boardm[u][4]=1;for(u=1;u<11;++u)n.boardm[u][5]=1;for(u=1;u<10;++u)n.boardm[u][6]=1;for(u=1;u<7;++u)n.boardm[u][7]=1;for(u=1;u<5;++u)n.boardm[u][8]=1;for(u=1;u<4;++u)n.boardm[u][9]=1;for(u=2;u<4;++u)n.boardm[u][10]=1,n.boardm[u][11]=1;for(u=3;u<5;++u)n.boardm[u][12]=1;for(u=7;u<9;++u)n.boardm[u][10]=1,n.boardm[u][11]=1;for(u=6;u<8;++u)n.boardm[u][3]=0,n.boardm[u][4]=0;n.boardm[5][13]=1;n.q(4,1,2);n.q(2,2,2);n.q(1,4,2);n.q(6,0,3);n.q(f,0,3);n.q(3,1,3);n.q(1,3,3);n.q(0,6,3);n.q(0,o,3);n.q(5,0,4);n.q(0,5,4);break;case"Random":for(c=[24,12,16,8],u=0;u<c.length;++u)while(c[u]>0)(l=randInt(0,14),a=randInt(0,14),n.boardm[l][a]||l===f&&a===o)||(n.boardm[l][a]=u+1,--c[u]);break;default:for(u=0;u<f;++u)for(e=0;e<o;++e)v=t*i-u-e,v%8==0?n.q(u,e,1):v%11==0?n.q(u,e,2):v%7==0&&n.q(u,e,3);n.q(f,0,3);n.q(0,o,3);n.q(0,1,0);n.q(0,2,4);n.q(1,0,0);n.q(1,1,3);n.q(2,0,1);n.q(2,5,3);n.q(2,6,0);n.q(3,5,0);n.q(4,1,4);n.q(4,4,0);n.q(4,7,3);n.q(5,2,3);n.q(5,3,0);n.q(6,5,2);n.q(8,2,0)}return g_boardmults=n.boardm,n.boardm};n.m=function(t,i,r){n.boardm[t][i]=r;n.boardm[n.bx-t-1][i]=r};n.q=function(t,i,r){var u=t,f=i,e=n.bx-t-1,o=n.by-i-1;n.boardm[u][f]=r;n.boardm[u][o]=r;n.boardm[e][f]=r;n.boardm[e][o]=r}}function cb(n){g_def=n.result}function debounce(n){var t;return function(){var r=this,i=arguments,u=function(){n.apply(r,i);this.debounced=undefined};clearTimeout(t);t=setTimeout(u,100);this.debounced?(clearTimeout(t),n.apply(this,i),this.debounced=undefined):this.debounced=!0}}function el(n){return document.getElementById(n)||document.querySelector(n)}function getJsonp(n,t){var u,f=Date.now(),r="handleJsonp"+f,e="getjson-"+f,o=function(){el(e).remove();delete window[r]},i=document.createElement("script");i.id=e;i.src=n.replace(/=\?/,"="+r);i.onload=function(){typeof t=="function"&&t(u);o()};i.onerror=function(){console.warn("Error retrieving data from "+n);o()};window[r]=function(n){u=n};document.head.appendChild(i)}function randFloat(n,t,i){return parseFloat(Math.min(n+Math.random()*(t-n),t).toFixed(i||0))}function randInt(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function setLang(n){localStorage.lang=n;gtag("event",n,{event_category:"Language"});location.reload()}function setLayout(n){localStorage.layout=n.value;gtag("event",n.value,{event_category:"Bonuses Layout"});location.reload()}function setTileset(n){localStorage.tileset=n.value;gtag("event",n.value,{event_category:"Tileset"});location.reload()}function showModal(n,t){t&&(g_cache.modalContainer.className=t);g_cache.modalContent.innerHTML=n;g_cache.modalMask.style.display="block";g_cache.modalContainer.style.display="block";setModalHeight();setTimeout(function(){var n=g_cache.modalContent.querySelector("input, button");n&&n.focus();g_cache.modalMask.classList.add("on");g_cache.modalContainer.classList.add("on")},0);[].forEach.call(g_cache.app.querySelectorAll("a[href], button"),function(n){n.tabIndex=-1})}function hideModal(){g_cache.modalContainer.classList.remove("on");g_cache.modalMask.classList.remove("on");g_bui.timer=setTimeout(function(){g_cache.modalContainer.style.display="none";g_cache.modalMask.style.display="none";g_cache.modalContent.style.height="";g_cache.modalContainer.removeAttribute("class")},300);[].forEach.call(g_cache.app.querySelectorAll("a[href], button"),function(n){n.tabIndex=0})}function setModalHeight(){g_cache.modalContainer.offsetHeight&&setTimeout(function(){g_cache.modalContent.style.height="";g_cache.modalContent.style.height=g_cache.modalContainer.clientHeight+"px"},50)}function getSession(){var n={board:g_board,boardp:g_boardpoints,boardt:g_boardtypes,hcount:g_bui.hcount,history:g_history,layout:g_layout,letpool:g_letpool,letscore:g_letscore,level:g_bui.level,loscore:el("loscore").textContent,lpscore:el("lpscore").textContent,orack:g_bui.getOpponentRack(),oscore:g_oscore,prack:g_bui.getPlayerRack(),pscore:g_pscore,passes:g_passes};return JSON.stringify(n)}function load(n){var t=JSON.parse(n),i,r,u;for(g_board=t.board,g_boardpoints=t.boardp,g_boardtypes=t.boardt,g_history=t.history,g_layout=t.layout,g_letpool=t.letpool,g_letscore=t.letscore,g_playlevel=t.level-1,g_bui.level=t.level,g_passes=t.passes,g_bui.create("board",g_boardwidth,g_boardheight,g_letscore,g_racksize,g_layout),g_bui.setOpponentRack(t.orack),g_bui.setPlayerRack(t.prack),g_matches_cache={},g_board_empty=!1,g_opponent_has_joker=t.orack.indexOf("*")>-1,i="<table>",r=0;r<g_history.length;++r)u=g_history[r],i+=g_bui.renderWordPlayed(u[0],u[1]);i+="</table>";el("history").innerHTML=i;g_bui.hlines=i;g_bui.hcount=t.hcount;g_oscore=t.oscore;g_bui.setOpponentScore(t.loscore,g_oscore);g_pscore=t.pscore;g_bui.setPlayerScore(t.lpscore,g_pscore);g_bui.setTilesLeft(g_letpool.length)}function RedipsUI(){var n=this;n.created=!1;n.plrRackId="pl";n.oppRackId="op";n.boardId="c";n.newplays={};n.racks=[];n.racks[1]=[];n.racks[2]=[];n.firstrack=!0;n.level=localStorage.level||1;n.hlines="";n.hcount=0;n.showOpRack=1;n.acceptPlayerPlacement=function(){n.newplays={};n.makeTilesFixed()};n.addToHistory=function(i,r){var f,e,o,s,u;for(r!==1&&r!==2&&(r=1),r=r-1,++n.hcount,f="<table>",e=0;e<i.length;++e)o=i[e],f+=n.renderWordPlayed(o,r),g_history.push([o,r]);f+="</table>";n.hlines+=f;s=el("history");s.innerHTML=n.hlines;s.scrollTop=n.hcount*100;i.length>0&&(u=el("status"),u.classList.add("transition"),clearTimeout(u.updateTimeout),u.updateTimeout=setTimeout(function(){u.classList.remove("marquee");r===0?(u.textContent=t("You")+" "+t("scored ")+el("lpscore").textContent+" "+t(" points for ")+i.join(", ").toUpperCase(),gtag("event","Player Move",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:i.join(", "),value:+el("lpscore").textContent})):(u.textContent=t("Computer")+" "+t("scored ")+el("loscore").textContent+" "+t(" points for ")+i.join(", ").toUpperCase(),gtag("event","Computer Move",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:i.join(", "),value:+el("loscore").textContent}));clearTimeout(u.delayTimeout);u.delayTimeout=setTimeout(function(){startMarquee(u)},3e3);u.classList.remove("transition")},100))};n.animDone=function(){--n.animTiles;n.playSound();n.animTiles===0&&n.animCallback()};n.cancelPlayerPlacement=function(i){for(var e,h,o,f,c=n.getPlayerPlacement(),s=[],u,r=0;r<c.length;++r)(u=c[r].id,i&&i!==u)||(e=el(u),s.push(e.firstChild),e.holds="",e.innerHTML="");for(h=0,r=0;r<n.racksize;++r)u=n.plrRackId+r,o=el(u),o.holds===""&&h<s.length&&(f=s[h++],f.holds.points===0&&(f.innerHTML="&nbsp;&nbsp;"),o.appendChild(f),o.holds=n.hcopy(f.holds));i?delete n.newplays[i]:n.newplays={};Object.keys(n.newplays).length===0&&(el("clear").textContent=t("Shuffle"),el("clear").onclick=onPlayerShuffle)};n.create=function(i,r,u,f,e,o){var k,a,h,v,y,p,w,d,nt,b,l,tt,it,s,c,g;if(!n.created){for(n.boardm=g_boardm.init(r,u,o),k='<picture><source type="image/webp" srcset="pics/arrow.webp"><img src="pics/arrow.png" width="22" height="22" alt=""></picture>',a='<tr class="ruler"><td colspan="2"></td></tr>',g_cache.html.miscBtns='<button id="highscores" class="button secondary disabled" title="'+t("High Scores")+'" onclick="g_bui.showHighScores()"><img src="pics/highscores.svg" alt="'+t("High Scores")+'"></button><button id="restart" class="button secondary" title="'+t("Restart")+'" onclick="g_bui.restart();if(g_isMobile)hideGameInfo()"><img src="pics/restart.svg" alt="'+t("Restart")+'"></button>',h='<div id="board" class="human-computer"></div>',h+='<div id="score"><div class="container"><header><button id="back"><svg version="1.1" viewBox="0 0 414.5 414.5" xmlns="http://www.w3.org/2000/svg"><polygon points="324.7 28.238 296.37 0 89.796 207.25 296.37 414.5 324.7 386.26 146.27 207.25" fill="currentColor"/></svg></button>'+g_cache.html.miscBtns+'<img src="pics/icon.svg" width="32" height="32" alt="Vietboard"></header><h2>'+t("Words Played")+'</h2><div id="history"></div><table class="gameinfo">'+a+'<tr class="level"><td>'+t("Level:")+'</td><td><span id="level" title="'+t("Computer can score up to ")+g_maxwpoints[g_playlevel]+t(" points per turn")+'">'+(g_playlevel+1)+'</span>&nbsp;<a class="link up'+(g_board_empty?"":" disabled")+'" title="'+t("Increase difficulty")+'" aria-label="'+t("Increase difficulty")+'" onclick="g_bui.levelUp()">'+k+'</a><a class="link down'+(g_board_empty?"":" disabled")+'" title="'+t("Decrease difficulty")+'" aria-label="'+t("Decrease difficulty")+'" onclick="g_bui.levelDn()">'+k+"</a></td></tr>",v=g_tilesets.indexOf(g_tileset)>-1?g_tileset:t("Default"),y='<select title="'+v+'" onchange="setTileset(this)"><option>'+v+"</option>",v!==t("Default")&&(y+='<option value="default">'+t("Default")+"</option>"),s=0;s<g_tilesets.length;++s)g_tilesets[s]!==v&&(y+="<option>"+g_tilesets[s]+"</option>");for(y+="</select>",p=g_layouts.indexOf(g_layout)>-1?g_layout:t("Default"),w='<select id="bonuseslayout" title="'+p+'" onchange="setLayout(this)"'+(g_board_empty?"":" disabled")+"><option>"+p+"</option>",p!==t("Default")&&(w+='<option value="default">'+t("Default")+"</option>"),s=0;s<g_layouts.length;++s)g_layouts[s]!==p&&(w+="<option>"+g_layouts[s]+"</option>");for(w+="</select>",h+="<tr><td>"+t("Tileset:")+"</td><td>"+y+"</td></tr><tr><td>"+t("Bonuses layout:")+"</td><td>"+w+"</td></tr>"+a+"<tr><td>"+t("Your last score:")+'</td><td id="lpscore">0</td></tr><tr class="highlight"><td>'+t("Your total score:")+'</td><td id="pscore">0</td></tr>'+a+"<tr><td>"+t("Computer&rsquo;s last score:")+'</td><td id="loscore">0</td></tr><tr class="highlight"><td>'+t("Computer&rsquo;s total score:")+'</td><td id="oscore">0</td></tr>'+a,h+='</table><footer><a href="https://fb.me/vietboardplay" class="social" title="'+t("Visit our Facebook Page to learn more")+'"><img src="pics/fb.svg" width="32" height="32" alt="Facebook"></a><span onclick="showWhatsNew()">v'+VER+"</span>"+(localStorage.lang==="vi"?"<a href=\"javascript:setLang('en')\">"+t("English")+"</a> | "+t("Vietnamese"):t("English")+" | <a href=\"javascript:setLang('vi')\">"+t("Vietnamese")+"</a>")+"</footer></div></div>",g_cache.app.innerHTML=h,n.scores=f,n.created=!0,n.racksize=e,n.bx=r,n.by=u,g_cache.html.h1='<h1><img src="pics/logo.svg" alt="Vietboard" onload="spinColors(this)"></h1>'+g_cache.html.miscBtns,h='<table id="scoreboard"><tr><td id="score-player">0</td><td class="spacer"></td><td class="logo"><img src="pics/logo.svg" alt="Vietboard" onload="spinColors(this)"><br><small id="status" onclick="startMarquee(this)">'+t("Tap on score for game info")+'</small></td><td class="spacer"></td><td id="score-opponent">0</td></tr></table>',h+='<div id="drag">',h+='<table class="opponent"><tr>',g_isMobile||(h+='<td class="mark">'+g_cache.html.h1+"</td>"),s=0;s<e;++s)h+='<td id="'+n.oppRackId+s+'"'+(DEBUG?' class="on"':"")+"></td>";for(h+="</tr></table>",d=n.getStartXY(),nt=["","DL","TL","DW","TW"],h+='<table class="board">',s=0;s<u;++s){for(h+="<tr>",c=0;c<r;++c)l=n.boardId+c+"_"+s,h+='<td id="'+l+'" ',b=c===d.x&&s===d.y?"ST":nt[n.boardm[c][s]]||"",b!==""&&(b='class="'+b+'"'),h+=b+">",g_board[c]&&g_board[c][s]&&(h+='<div class="drag t'+g_boardtypes[c][s]+'">'+(g_board[c][s]===" "?"&nbsp;&nbsp;":g_board[c][s].toUpperCase())+(g_boardpoints[c][s]?"<sup><small>"+g_boardpoints[c][s]+"</small></sup>":"")+"</div>"),h+="</td>";h+="</tr>"}for(h+="</table>",h+='<table class="player"><tr>',s=0;s<e;++s)h+='<td id="'+n.plrRackId+s+'"></td>';for(g_isMobile&&(h+="</tr><tr>"),h+='<td class="mark"'+(g_isMobile?' colspan="8"':"")+'><button class="button" onclick="onPlayerMoved()">'+t("Play")+'</button><button id="clear" class="button secondary" onclick="onPlayerShuffle()">'+t("Shuffle")+'</button><button class="button secondary" onclick="onPlayerSwap()">'+t("Swap")+'</button><button id="pass" class="button secondary" onclick="onPlayerMoved(true)">'+t("Pass")+"</button></td></tr></table></div>",el(i).innerHTML=h,toggleMobile(),s=0;s<e;++s)tt=n.plrRackId+s,it=n.oppRackId+s,el(tt).holds="",el(it).holds="";for(s=0;s<u;++s)for(c=0;c<r;++c)l=n.boardId+c+"_"+s,g_board[c]&&g_board[c][s]?(g={letter:g_board[c][s],points:g_boardpoints[c][s]},el(l).holds=g,el(l).firstChild.holds=g):el(l).holds="";n.rd=REDIPS.drag;n.initRedips()}};n.fixPlayerTiles=function(){for(var r,i,t=0;t<n.racks[1].length;++t)r=n.plrRackId+t,i=el(r).firstChild,i&&n.rd.enableDrag(!1,i)};n.getBoard=function(){for(var i,u=[],f=[],e=[],t=0;t<n.bx;++t)for(u[t]=[],f[t]=[],e[t]=[],i=0;i<n.by;++i){var c=n.boardId+t+"_"+i,r=el(c),o="",s=0,h=0;r.holds!==""&&(o=r.holds.letter,s=r.holds.points);r&&r.firstChild&&(h=+r.firstChild.classList.contains("t2")+1);u[t][i]=o;f[t][i]=s;e[t][i]=h}return{board:u,boardp:f,boardt:e}};n.getOpponentRack=function(){return n.racks[2]};n.getPlayerPlacement=function(){var u=[],i=n.newplays,t,f,r;for(t in i)f=t.substr(1),r=f.split("_"),u.push({id:t,ltr:i[t].letter,lsc:i[t].points,x:+r[0],y:+r[1]});return u};n.getPlayerRack=function(){return n.racks[1]};n.getPlayLevel=function(){return n.level-1};n.getStartXY=function(){var t=Math.round(n.bx/2)-1,i=Math.round(n.by/2)-1;return{x:t,y:i}};n.hcopy=function(n){return n===undefined||n===""||n===null?"":{letter:n.letter,points:n.points}};n.initRedips=function(){n.rd.init();n.rd.dropMode="single";n.rd.animation.pause=g_animation;n.rd.event.dropped=function(){var i=n.hcopy(n.rd.obj.holds),r,u;if(n.rd.td.target.holds=i,r=n.rd.td.target.id,u=n.rd.td.source.id.charAt(0),r.charAt(0)===n.boardId){if(n.playSound(),el("clear").textContent=t("Clear"),el("clear").onclick=onPlayerClear,i&&i.points===0){n.showLettersModal(r);return}n.newplays[r]=n.hcopy(i)}else r.charAt(0)==="p"&&(i&&i.points===0&&u===n.boardId&&(n.rd.obj.innerHTML="",n.rd.obj.holds={letter:"",points:0}),Object.keys(n.newplays).length===0&&(el("clear").textContent=t("Shuffle"),el("clear").onclick=onPlayerShuffle))};n.rd.event.moved=function(){n.rd.td.source.holds="";var t=n.rd.td.source.id;t.charAt(0)===n.boardId&&delete n.newplays[t]}};n.levelDn=function(){g_board_empty&&(n.level>1&&--n.level,el("level").textContent=n.level,el("level").title=t("Computer can score up to ")+g_maxwpoints[n.level-1]+t(" points per turn"),g_playlevel=n.level-1,localStorage.level=n.level)};n.levelUp=function(){g_board_empty&&(n.level<g_maxwpoints.length&&++n.level,el("level").textContent=n.level,el("level").title=t("Computer can score up to ")+g_maxwpoints[n.level-1]+t(" points per turn"),g_playlevel=n.level-1,localStorage.level=n.level)};n.makeTilesFixed=function(){var t,i;for(n.rd.enableDrag(!1,"#drag div"),t=0;t<n.racks[1].length;++t){var u=n.plrRackId+t,f=n.oppRackId+t,r=el(f).firstChild;r&&n.rd.enableDrag(!1,r);i=el(u).firstChild;i&&n.rd.enableDrag(!0,i)}};n.onSelLetter=function(t){var i={letter:t,points:0},r,u,f;return n.newplays[n.bdropCellId]=i,r=el(n.bdropCellId),r.holds=n.hcopy(i),u="",u+=t!==" "&&t!=="*"?t.toUpperCase():"&nbsp;&nbsp;",f=r.firstChild,f.holds=n.hcopy(i),f.innerHTML=u,hideModal(),n.bdropCellId};n.onSwap=function(t){var r="",f="",u,i;if(t)r=n.getPlayerRack();else for(u=0;;++u){if(i=el("swap-candidate"+u),!i)break;i.firstChild&&(i.firstChild&&i.classList.contains("to-swap")?f+=i.firstChild.holds.letter:r+=i.firstChild.holds.letter)}hideModal();onPlayerSwapped(r,f)};n.onSwapToggle=function(n){n.classList.contains("to-swap")||document.querySelectorAll("#swaptable .to-swap").length!==g_letpool.length?(n.classList.toggle("to-swap"),el("swaptable").title=t("Select the letters you want to swap")):el("swaptable").title=t("No tiles left to swap")};n.playOpponentMove=function(t,i){function g(t,i){setTimeout(function(){n.rd.moveObject(t)},i)}function it(n,t){return n.x-t.x}function rt(n,t){return n.y-t.y}for(var c,u,b,a,f,h,y,p,k,w,d,o=n.racks[2],l=o,s={},r=0;r<t.length;++r)c=t[r],u=c.ltr,u in s?s[u].push(c):s[u]=[c],o.search(u)===-1?(b=o.search("\\*"),o=o.replace("*","_"),l=l.replace("*",u),u=u!==" "?u.toUpperCase():"&nbsp;&nbsp;",el(n.oppRackId+b).innerHTML='<div class="drag t2">'+u+"</div>"):o=o.replace(u,"_");for(n.displayedcells=[],a=l.split(""),n.fixPlayerTiles(),f=[],r=0;r<a.length;++r)if(h=a[r],h in s&&s[h].length>0){var e=s[h][0],nt=n.oppRackId+r,tt=n.boardId+e.x+"_"+e.y,v=el(nt);v.style.display="";n.displayedcells.push(v);y=v.firstChild;p=el(tt);y.holds={letter:e.ltr,points:e.ltscr};n.animTiles=t.length;n.animCallback=i;k={obj:y,target:p,callback:n.animDone};f.push({info:k,x:e.x,y:e.y});p.holds={letter:e.ltr,points:e.lscr};s[h].splice(0,1)}for(w=f.length,w>1&&(f[0].x!==f[1].x?f.sort(it):f.sort(rt)),r=0;r<w;++r)d=g_wait*r,g(f[r].info,d)};n.playSound=function(){g_cache.sound.play()};n.prompt=function(n,i,r){showModal(n+'<div class="buttons">'+(i||'<button class="button" onclick="hideModal()">'+t("OK")+"</button>")+"</div>",r)};n.removeFromOpponenentRack=function(t){n.removeFromRack(2,t)};n.removeFromPlayerRack=function(t){n.removeFromRack(1,t)};n.removeFromRack=function(t,i){for(var e,f,o,u={},r=0;r<i.length;++r)e=i.charAt(r),e in u?++u[e]:u[e]=1;for(f=n.racks[t].split(""),r=0;r<f.length;++r)o=f[r],o in u&&u[o]>0&&(delete f[r],--u[o]);n.racks[t]=f.join("")};n.renderWordPlayed=function(n,i){return'<tr class="player-'+i+'"><td>'+n.toUpperCase()+'</td><td><a class="link" title="'+t("Show definition")+'" aria-label="'+t("Show definition")+'" onclick="g_bui.wordInfo(\''+n+'\')"><img src="pics/info.svg" width="22" height="22" alt=""></a></td></tr>'};n.restart=function(){localStorage.removeItem("session");g_bui=new RedipsUI;init("board")};n.setLetters=function(t,i){var r,h,u,f,e,c,s,l;n.racks[t]=i;var o=[],a=t===1?n.plrRackId:n.oppRackId,v=i.toUpperCase();for(r=0;r<n.racksize;++r)h=a+r,u=el(h),u.firstChild&&u.removeChild(u.firstChild),f=r<i.length?i.charAt(r):"",f!==""?(o.push(u),e='<div class="drag t'+t+'">',c={letter:f,points:n.scores[f]},u.holds=c,f!=="*"?(s=v.charAt(r),e+=(s!==" "?s:"&nbsp;&nbsp;")+"<sup><small>"+n.scores[f]+"</small></sup>"):e+="&nbsp;&nbsp;",e+="</div>",u.innerHTML=e):u.holds="";for(r in o)l=o[r].firstChild,l.holds=n.hcopy(o[r].holds)};n.setPlayerRack=function(t){n.setLetters(1,t);n.firstrack&&(n.firstrack=!1,n.initRedips())};n.setPlayerScore=function(n,t){el("lpscore").textContent=n;el("pscore").textContent=t;el("score-player").textContent=t};n.setOpponentRack=function(t){n.setLetters(2,t)};n.setOpponentScore=function(n,t){el("loscore").textContent=n;el("oscore").textContent=t;el("score-opponent").textContent=t};n.setTilesLeft=function(n){el("tleft")&&(el("tleft").innerHTML='<a href="javascript:g_bui.showTilesLeft()">'+n+"</a>")};n.showBusy=function(){showModal(t("Computer thinking, please wait..."))};n.showHighScores=function(){alert("Coming soon...")};n.showLettersModal=function(t){var u,r;n.bdropCellId=t;var f=g_letters.length,i="";for(u=0;u<f;++u)r=g_letters[u][0],r!=="*"&&(i+='<button class="button secondary" onclick="g_bui.onSelLetter(\''+r+"')\">",i+=(r===" "?"&nbsp;":r.toUpperCase())+"</button>");i='<div id="letters">'+i+"</div>";showModal(i,"center wide")};n.showSwapModal=function(){for(var f,r=[],u='<table id="swaptable" class="centered" title="'+t("Select the letters you want to swap")+'"><tr>',i=0;i<n.racksize;++i)(f=el(n.plrRackId+i),f.holds!=="")&&(r.push(f.firstChild),u+='<td id="swap-candidate'+i+'" class="tile" onclick="g_bui.onSwapToggle(this)"></td>');for(u+="</tr></table>",n.prompt(u,'<button class="button" onclick="g_bui.onSwap()">'+t("Swap")+" & "+t("Pass")+"</button>","wide"),i=0;i<r.length;++i)n.rd.enableDrag(!1,r[i]),el("swap-candidate"+i).appendChild(r[i])};n.showTilesLeft=function(){var t=g_letpool.sort().reduce(function(n,t){return t===" "?t="&lt;space&gt;":t==="*"&&(t="&lt;blank&gt;"),n[t]=(n[t]||0)+1,n},{});n.prompt('<div class="debug">'+JSON.stringify(t).replace(/[{}"]/g,"").replace(/([:,])/g,"$1 ")+"</div>")};n.wordInfo=function(i){var r,e,o,u,f,s;if(!window.g_defs){alert(t("Word definitions not enabled."));return}if(i in g_defs){if(r='<div id="wordresult"><div style="text-align:center"><h1>'+i+"</h1></div>",typeof g_defs[i]=="string")r+='<div class="phanloai">&nbsp;</div>'+g_defs[i];else for(e in g_defs[i])for(r+='<div class="phanloai">'+(e||"&nbsp;")+"</div>",o=0;o<g_defs[i][e].length;++o){if(u=g_defs[i][e][o],r+='<ul class="list1"><li>'+u.definition,u.examples)for(f=0;f<u.examples.length;++f)for(s in u.examples[f])r+='<ul class="list2"><li><span class="example-original">'+s+"</span><br>"+u.examples[f][s]+"</li></ul>";r+="</li></ul>"}r+="</div>";n.prompt(r)}else getJsonp("https://m.vdict.com/mobile/dictjson?fromapp=1&word="+encodeURIComponent(i)+"&dict=2",function(){g_def=g_def.replace('href="#"','title="'+t("Listen to pronunciation")+'" onclick="el(\'audio\').play()"');g_def=g_def.replace(" Suggestions:","");g_def=g_def.replace(/">(.+?) not found/,'"><strong>$1</strong> '+t("has no definition or may be part of a compound word"));n.prompt(g_def);gtag("event",i,{event_category:"Definition",event_label:g_def.indexOf("</strong> "+t("not found"))<0?"Found":"Not Found"})})}}function init(n){var u,t,r;for(g_board=[],g_boardpoints=[],g_boardtypes=[],g_letpool=[],g_letscore={},g_matches_cache={},g_pscore=0,g_oscore=0,g_passes=0,g_board_empty=!0,g_history=[],u=g_letters.length,t=0;t<u;++t){var i=g_letters[t],f=i[0],e=i[1],o=i[2];for(g_letscore[f]=e,r=0;r<o;++r)g_letpool.push(f)}shufflePool();g_bui.create(n,g_boardwidth,g_boardheight,g_letscore,g_racksize,localStorage.layout);g_bui.setOpponentRack(takeLetters(""));g_bui.setPlayerRack(takeLetters(""));g_bui.setTilesLeft(g_letpool.length)}function announceWinner(){for(var u,i,f,r,h,e=g_bui.getOpponentRack(),o=g_bui.getPlayerRack(),s=0,n=0;n<e.length;++n)s+=g_letscore[e.charAt(n)];for(u=0,n=0;n<o.length;++n)u+=g_letscore[o.charAt(n)];for(g_oscore-=s,g_pscore-=u,i='<table id="gameover" class="centered"><tr>',f="GAMEOVER",n=0;n<f.length;++n)i+='<td class="tile"><div class="drag t'+randInt(1,2)+'">'+f[n]+"</div></td>";i+="</tr></table><ul><li>";i+=t("You")+": <strong>"+g_pscore+"</strong></li><li>"+t("Computer")+": <strong>"+g_oscore+"</strong></li></ul>";r="<h3>"+t("It&rsquo;s a tie!");g_oscore>g_pscore?r='<h3 class="opponent">'+t("Computer wins."):g_oscore<g_pscore&&(r='<h3 class="player">'+t("You win!"));i+=r+"</h3>";g_bui.prompt(i,'<button class="button" onclick="hideModal();g_bui.restart()">'+t("Play Again")+"</button>","gameover wide");h=setInterval(function(){var n=el("#gameover td:not(.on)");n?el("#gameover td:not(.on)").classList.add("on"):clearInterval(h)},100);el("oscore").textContent=g_oscore;el("pscore").textContent=g_pscore;el("score-opponent").textContent=g_oscore;el("score-player").textContent=g_pscore;localStorage.removeItem("session");gtag("event","Game Over",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"Player="+g_pscore+", Computer="+g_oscore,value:g_letpool.length})}function checkValidPlacement(n){var v,it,ut,ct,a,y,p,w,b;if(n.length===0)return{played:"",msg:t("no letters were placed.")};var rt={},o="",h="",i=n[0].x,r=n[0].y,k=i,d=r,u=0,s=0,st=g_bui.getStartXY(),ht=!1,f,e,g;for(a=0;a<n.length;++a)v=n[a],h+=v.lsc===0?"*":v.ltr,f=v.x,e=v.y,f===st.x&&e===st.y&&(ht=!0),g=f+"_"+e,rt[g]=v,i>f&&(i=f),k<f&&(k=f),r>e&&(r=e),d<e&&(d=e);if(r<d&&(s=1),i<k&&(u=1),u===1&&s===1)return{played:"",msg:t("word must be horizontal or vertical.")};if(g_board_empty&&!ht)return{played:"",msg:t("first word must be on the star.")};if(it=g_board.length,ut=it,u===0&&s===0)if(i>0&&g_board[i-1][r]!==""||i<it-1&&g_board[i+1][r]!=="")u=1;else if(r>0&&g_board[i][r-1]!==""||r<ut-1&&g_board[i][r+1]!=="")s=1;else return h=h===" "?"<em>space</em>":h==="*"?"<em>blank</em>":h.toUpperCase(),h="<strong>"+h+"</strong>",ct=h+t(" is not connected to a word."),{played:"",msg:ct};var pt=u===1?k-i+1:d-r+1,lt=i-u,at=r-s,c="",vt=1,nt=0,ft=0,l,et=[];for(a=0;a<pt;++a){if(f=lt+u,e=at+s,l=g_board[f][e],l==="")return{played:"",msg:t("you have to place tiles next to each other.")};if(g=f+"_"+e,g in rt){var wt=rt[g],yt=g_boardmults[f][e],ot=wt.lsc,tt=getOrthWordScore(l,ot,f,e,u,s);ot*=g_lmults[yt];nt+=ot;vt*=g_wmults[yt];tt.score===-1&&(o!==""&&(o+=", "),o+=tt.word.toUpperCase());tt.score>0&&(ft+=tt.score,et.push(tt.word))}else nt+=g_boardpoints[f][e];c+=l;lt+=u;at+=s}for(y=i-u,p=r-s;y>=0&&p>=0&&g_board[y][p]!=="";)l=g_board[y][p],nt+=g_boardpoints[y][p],c=l+c,y-=u,p-=s;for(w=k+u,b=d+s;w<it&&b<ut&&g_board[w][b]!=="";)l=g_board[w][b],nt+=g_boardpoints[w][b],c+=l,w+=u,b+=s;return(c in g_wordmap||(o!==""&&(o+=", "),o+=c.toUpperCase()),o!=="")?(gtag("event","Word Not Found",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:o}),o="<strong>"+o+"</strong>",o+=t(" not found in dictionary."),{played:"",msg:o}):!g_board_empty&&ft===0&&c.length===n.length?{played:"",msg:t("word is not connected.")}:(et.push(c),{played:h,score:nt*vt+ft,words:et})}function findBestMove(n){for(var i,r,e=n.split(""),u=-1,f=null,t=0;t<g_board.length;++t)for(i=0;i<g_board[t].length;++i)g_board[t][i]===""&&(r=findBestWord(e,t,i),r.score>u&&(u=r.score,f=r));return f}function findBestWord(n,t,i,r){var o=-1,s={score:-1},h,u,c,e,f;r||(r=Math.random()<.5?["x","y"]:["y","x"]);for(h in r){switch(g_playlevel){case 0:u=randFloat(50,100,16);break;case 1:u=randFloat(55,100,16);break;case 2:u=randFloat(60,100,16);break;case 3:u=randFloat(65,100,16);break;case 4:u=randFloat(70,100,16);break;case 5:u=randFloat(75,100,16);break;case 6:u=randFloat(80,100,16);break;case 7:u=randFloat(85,100,16);break;case 8:u=randFloat(90,100,16);break;case 9:u=randFloat(95,100,16)}Math.random()>u/100||(c=r[h],e=getRegex(c,t,i,n.join("")),e!==null&&(f=getBestScore(e,n,t,i),f.score>o&&(o=f.score,s=f)))}return s}function findFirstMove(n,t){for(var u,o,e,f,i={score:-1},r={score:-1},h=function(){for(var o=0,n;o<t+1;++o)n=o,g_board[n][t]=e,g_boardpoints[n][t]=f,r=findBestWord(u,n+1,t,["x"]),r.score>i.score&&r.ps+r.word.length>t&&(i=r,i.aletscr=f),g_board[n][t]="",g_boardpoints[n][t]=0},c=function(){for(var o=0,n;o<t+1;++o)n=o,g_board[t][n]=e,g_boardpoints[t][n]=f,r=findBestWord(u,t,n+1,["y"]),r.score>i.score&&r.ps+r.word.length>t&&(i=r,i.aletscr=f),g_board[t][n]="",g_boardpoints[t][n]=0},s=0;s<n.length;++s)u=n.split(""),o=s,e=u[o],f=g_letscore[e],u.splice(o,1),Math.random()<.5?(h(),c()):(c(),h());return i.score===-1?null:(i[i.xy==="x"?"ax":"ay"]=i.ps,i.lscrs.unshift(i.aletscr),i.prec="",i.seq=i.word,i)}function getBestScore(n,t,i,r){for(var s,d,h,tt,c,e,o,p,l,w,g,a,b,k,f,v,y={},nt=0,u=0;u<t.length;++u)s=t[u],s==="*"?++nt:s in y?++y[s]:y[s]=1;if(d=-1,h={score:-1},n.max-1>=g_wstr.length)return h;for(tt=new RegExp(n.rgx,"g"),l=n.min-2;l<n.max-1;++l){if(w=n.rgx+l,w in g_matches_cache)e=g_matches_cache[w];else{for(e=[];(c=tt.exec(g_wstr[l]))!==null;){for(o="",u=1;u<c.length;++u)c[u]&&(o+=c[u]);g=c[0];p=g.substr(1,g.length-2);e.push({word:p,reqs:o})}g_matches_cache[w]=e}for(a=0;a<e.length;++a){b=[];o=e[a].reqs;p=e[a].word;var it=gCloneFunc(y),rt=!0,ut=nt;for(u=0;u<o.length;++u)if(k=o.charAt(u),it[k]>0)--it[k],b.push(g_letscore[k]);else{if(ut===0){rt=!1;break}--ut;b.push(0)}rt&&(f={word:p,ax:i,ay:r},f.seq=o,f.lscrs=b,f.ps=n.ps,f.xy=n.xy,f.prec=n.prec,v=getWordScore(f),v<=g_maxwpoints[g_playlevel]&&d<v&&(d=v,h=f,h.score=v))}}return h}function getOrthWordScore(n,t,i,r,u,f){var c=1,h=0,e=i,o=r,v=g_board.length,y=g_board[i].length,p=g_board[e][o],w=g_boardpoints[e][o],l=g_boardmults[e][o],s,a;for(c*=g_wmults[l],t*=g_lmults[l],g_board[e][o]=n,g_boardpoints[e][o]=t;i>=0&&r>=0&&g_board[i][r]!=="";)i-=f,r-=u;for((i<0||r<0||g_board[i][r]==="")&&(i+=f,r+=u),s="";i<v&&r<y&&g_board[i][r]!=="";)a=g_board[i][r],h+=g_boardpoints[i][r],s+=a,i+=f,r+=u;return(g_board[e][o]=p,g_boardpoints[e][o]=w,s.length===1)?{score:0,word:s}:(s in g_wordmap)?(h*=c,{score:h,word:s}):{score:-1,word:s}}function getRegex(n,t,i,r){var st="["+r+"]",ht,yt,pt,h,p,bt,kt;if(g_opponent_has_joker&&(st=g_letrange),ht=r.length,g_board[t][i]!=="")return null;var ct=n==="x",e=ct?t:i,c=ct?g_board.length:g_board[t].length,o=ct?1:0,s=1-o,b=!1,tt=t-o,it=i-s;e>0&&g_board[tt][it]!==""&&(b=!0);var lt=e,rt=t+o,ut=i+s,at=c,vt;for(b||(vt=0);lt<c-1;){if(g_board[rt][ut]!==""){b=!0;break}else++vt;if(vt>ht)break;if(it=ut-o,tt=rt-s,yt=ut+o,pt=rt+s,tt>=0&&it>=0&&g_board[tt][it]!==""||pt<c&&yt<c&&g_board[pt][yt]!==""){at=lt+1;b=!0;break}rt+=o;ut+=s;++lt}if(!b)return null;for(var k=e-1,v=t-o,y=i-s;k>=0&&g_board[v][y]!=="";)v-=o,y-=s,--k;for(k<0&&(k=0,v<0?v=0:y<0&&(y=0)),h="",p=k;p<e;++p)h+=g_board[v][y],v+=o,y+=s;for(var d=t,g=i,l=e,dt="_",u="_"+h,ft="",gt=0,f=0,a=0,wt=1,nt,et=h.length,ot=e,w;l<c;){if(w=g_board[d][g],w===""){if(l===e&&et>0?(a=et+1,nt=!0):nt=!1,++f,gt===ht)break;++gt}else f>0&&(u+="("+st,f>1&&(h!==""&&(ft="|"+u,f>2&&(ft+="{1,"+(f-1)+"}"),ft+=")"+dt),u+="{"+f+"}"),u+=")",a===0&&(a=et+f,nt=!0),nt&&ot===e&&(ot=l),f=0),u+=w,nt&&++a,wt=0;d+=o;g+=s;++l}if(f>0){if(u+="("+st,l===c)u+="{"+wt+","+f+"}";else if(g_board[d][g]==="")u+="{"+wt+","+f+"}";else for(u+="{"+f+"}",p=l+1;p<c;++p){if(w=g_board[d][g],w==="")break;u+=w;d+=o;g+=s}u+=")"}return ot===e?a=h!==""?et+1:at-e+1:(bt=ot-at,bt>1&&(a-=bt)),kt=e-h.length,u+=dt+ft,{min:a,max:l-kt,prec:h,ps:kt,rgx:u,xy:n}}function getWordScore(n){var s=n.xy==="x",c=n.ax,k=n.ay,d=s?g_board.length:g_board[c].length,h=s?1:0,l=1-h,f=n.ps,a=n.seq,v=0,t,i;s?(t=f,i=k):(t=c,i=f);for(var y=[],r=0,p=0,g=0,nt=n.lscrs,w=1,e,o,b,u;f<d;){if(e=g_boardmults[t][i],w*=g_wmults[e],g_board[t][i]===""){if(o=nt[v],b=a.charAt(v++),u=getOrthWordScore(b,o,t,i,h,l),u.score===-1)return-1;u.score>0&&y.push(u.word);o*=g_lmults[e];r+=o;p+=u.score}else r+=g_boardpoints[t][i]*g_lmults[e];if(t+=h,i+=l,++f,++g===n.word.length)break}return r*=w,a.length===g_racksize&&(r+=g_allLettersBonus),n.owords=y,r+p}function onPlayerClear(){g_bui.cancelPlayerPlacement()}function onPlayerMove(){var o=self.passed,f,i,e,r,u,n,s,h;if(o&&(++g_passes,g_passes>=g_maxpasses)){announceWinner();return}if(f=g_bui.getBoard(),g_board=f.board,g_boardpoints=f.boardp,g_boardtypes=f.boardt,o)g_bui.cancelPlayerPlacement();else{if(i=checkValidPlacement(g_bui.getPlayerPlacement()),e=i.played,e===""){g_bui.prompt(gErrPrefix()+i.msg);return}if(g_bui.acceptPlayerPlacement(),g_board_empty&&(g_board_empty=!1,el("a.link.up").classList.add("disabled"),el("a.link.down").classList.add("disabled"),el("bonuseslayout").disabled=!0),g_passes=0,e.length===g_racksize&&(g_pscore+=g_allLettersBonus),g_pscore+=i.score,g_bui.setPlayerScore(i.score,g_pscore),g_bui.addToHistory(i.words,1),g_bui.removeFromPlayerRack(e),r=g_bui.getPlayerRack(),r=takeLetters(r),r===""){announceWinner();return}g_bui.setPlayerRack(r);g_bui.setTilesLeft(g_letpool.length)}if(u=g_bui.getOpponentRack(),g_opponent_has_joker=u.search("\\*")!==-1,g_playlevel=g_bui.getPlayLevel(),g_board_empty?(s=g_bui.getStartXY(),n=findFirstMove(u,s.y)):n=findBestMove(u),h=function(){var i,r,f,e,t,o,h,s;for(g_bui.makeTilesFixed(),i=n.owords,i.push(n.word),g_bui.addToHistory(i,2),r=n.score,g_oscore+=r,n.seq.length===g_racksize&&(g_oscore+=g_allLettersBonus),g_bui.setOpponentScore(r,g_oscore),f=n.seq,e="",t=0;t<f.length;++t)o=f.charAt(t),e+=u.search(o)>-1?o:"*";if(g_bui.removeFromOpponenentRack(e),h=g_bui.getOpponentRack(),s=takeLetters(h),s===""){announceWinner();return}g_bui.setOpponentRack(s);g_bui.setTilesLeft(g_letpool.length);el("pass").disabled=!1;localStorage.session=getSession()},n!==null)placeOnBoard(n,h),g_passes=0;else{gtag("event","Computer Pass",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"["+g_bui.getOpponentRack()+"]",value:g_letpool.length});++g_passes;g_passes>=g_maxpasses?announceWinner():(g_bui.prompt(t("I pass, your turn.")),g_bui.makeTilesFixed(),localStorage.session=getSession());return}}function onPlayerMoved(n,t){n&&(el("pass").disabled=!0,g_bui.cancelPlayerPlacement(),g_bui.showBusy());self.passed=n;clearTimeout(g_bui.timer);setTimeout(onPlayerMove,100);n&&gtag("event","Player "+(t?"Swap":"Pass"),{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"["+g_bui.getPlayerRack()+"]",value:g_letpool.length})}function onPlayerShuffle(){var u=el("clear"),i,t,r;u.disabled=!0;document.documentElement.classList.add("shuffling");var n=[],f=0,e=function(){++f==g_racksize/2&&(u.disabled=!1,document.documentElement.classList.remove("shuffling"))};for(t=0;t<g_racksize;++t)n.push(t);while(n.length>0)i=Math.floor(Math.random()*n.length),t=n[i],n.splice(i,1),i=Math.floor(Math.random()*n.length),r=n[i],n.splice(i,1),g_bui.rd.moveObject({obj:el("pl"+t).firstChild,target:el("pl"+r)}),g_bui.rd.moveObject({obj:el("pl"+r).firstChild,target:el("pl"+t),callback:e})}function onPlayerSwap(){if(g_letpool.length===0){g_bui.prompt(gErrPrefix()+t("no tiles left to swap."));return}g_bui.cancelPlayerPlacement();g_bui.showSwapModal()}function onPlayerSwapped(n,t){if(t.length===0){g_bui.setPlayerRack(n);g_bui.makeTilesFixed();return}for(var i=0;i<t.length;++i)g_letpool.push(t.charAt(i));shufflePool();g_bui.setPlayerRack(takeLetters(n));onPlayerMoved(!0,!0)}function placeOnBoard(n,t){var u=0,c=n.seq.length,o=1,s=0;n.xy==="y"&&(o=0,s=1);for(var i=n.ax,r=n.ay,h=[],f,e;u<c;)g_board[i][r]===""&&(f=n.seq.charAt(u),e=n.lscrs[u++],h.push({x:i,y:r,ltr:f,lscr:e}),g_board[i][r]=f,g_boardpoints[i][r]=e,g_boardtypes[i][r]=2),i+=o,r+=s;hideModal();g_bui.playOpponentMove(h,t);g_board_empty&&(g_board_empty=!1,el("a.link.up").classList.add("disabled"),el("a.link.down").classList.add("disabled"),el("bonuseslayout").disabled=!0)}function shufflePool(){for(var i=g_letpool.length,t,r,n=0;n<i;++n)t=Math.floor(Math.random()*i),r=g_letpool[n],g_letpool[n]=g_letpool[t],g_letpool[t]=r}function takeLetters(n){var t=g_letpool.length,i,r;return t===0?n:(i=Math.min(g_racksize-n.length,t),r=g_letpool.splice(0,i).join(""),n+r)}function closeModal(){if(el("swaptable"))g_bui.onSwap(!0);else if(el("letters"))g_bui.cancelPlayerPlacement(g_bui.onSelLetter("*"));else{var n=g_cache.modalContent.querySelector(".button");n?n.click():hideModal()}}function handleHideModal(n){n.target&&n.target.id==="modal-inner"&&closeModal()}function handleKeyDown(n){n.key==="Escape"&&closeModal()}function showGameInfo(){document.documentElement.classList.add("gameinfo")}function hideGameInfo(){document.documentElement.classList.remove("gameinfo")}function spinColors(n){var t=0,i=setInterval(function(){n.style.filter="hue-rotate("+randInt(0,360)+"deg)";++t==20&&(clearInterval(i),[].forEach.call(document.querySelectorAll('img[alt="Vietboard"]'),function(t){t!==n&&(t.style.filter=n.style.filter)}))},100)}function startMarquee(n){n.classList.contains("marquee")||(n.classList.toggle("marquee",n.offsetWidth<n.scrollWidth),clearTimeout(n.marqueeTimeout),n.marqueeTimeout=setTimeout(function(){n.classList.remove("marquee")},4e3))}function toggleMobile(){var n,i,r,t;document.documentElement.className!=="loaded error"&&(g_isMobile=window.outerWidth<window.outerHeight,document.documentElement.classList.toggle("mobile",g_isMobile),n=el("#drag .player td.mark"),g_isMobile?(i=el("#drag .opponent td.mark"),i&&(i.remove(),r=document.createElement("tr"),n.setAttribute("colspan",g_racksize),r.appendChild(n),el("#drag .player tbody").appendChild(r))):el("#drag .player td.mark:first-child")&&(t=document.createElement("td"),t.className="mark",t.innerHTML=g_cache.html.h1,el("#drag .opponent tr").insertBefore(t,el("op0")),el("#drag .player tr:first-child").appendChild(n),n.removeAttribute("colspan"),el("#drag .player tr:last-child").remove()),setModalHeight())}function showWhatsNew(){g_bui.prompt("<h3>What's New</h3><ul><li>Added restart button</li><li>Replaced top button text with icon</li><li>Fixed not being able to change bonuses layout</li><li>Fixed game info left column width changes after first move</li></ul>")}var REDIPS=REDIPS||{},g_boardm,g_bui,g_def,g_history,g_cache,gCloneFunc,gErrPrefix;REDIPS.drag=function(){var or,ht,wt,sr,wi,bi,hr,cr,bt,kt,dt,ki,di,ct,ri,gi,ot,gt,at,nr,tt,p,et,ui,fi,ei,tr,oi,ir,rt,b,rr,lr,ni,ti,si,ar,vr,yr,pr,ur,hi,ci,li,wr,ii,fr,br,ai,kr,l=null,h={width:0,height:0},e={width:null,height:null,container:[],obj:null},r={page:{x:0,y:0},div:{x:0,y:0},flag:{x:0,y:0}},vt,n=[],yt,vi,a,lt=[],s=[],k=null,it=null,nt={x:0,y:0},ut={x:0,y:0,value:7,flag:!1},er=!1,pt=!1,yi=[],i=null,y=null,d=null,u=null,w=null,ft=null,o=null,g=null,st=null,t=!1,c=!1,v="cell",pi={div:[],cname:"only",other:"deny"},dr={action:"deny",cname:"mark",exception:[]},f={},gr={keyDiv:!1,keyRow:!1,sendBack:!1,drop:!1},nu={changed:function(){},clicked:function(){},cloned:function(){},clonedDropped:function(){},clonedEnd1:function(){},clonedEnd2:function(){},dblClicked:function(){},deleted:function(){},dropped:function(){},droppedBefore:function(){},finish:function(){},moved:function(){},notCloned:function(){},notMoved:function(){},shiftOverflow:function(){},relocateBefore:function(){},relocateAfter:function(){},relocateEnd:function(){},rowChanged:function(){},rowClicked:function(){},rowCloned:function(){},rowDeleted:function(){},rowDropped:function(){},rowDroppedBefore:function(){},rowDroppedSource:function(){},rowMoved:function(){},rowNotCloned:function(){},rowNotMoved:function(){},rowUndeleted:function(){},switched:function(){},undeleted:function(){}};return or=function(n){var u=this,i,r,t;for((n===undefined||typeof n!="string")&&(n="drag"),k=document.getElementById(n),document.getElementById("redips_clone")||(r=document.createElement("div"),r.id="redips_clone",k.appendChild(r)),wt("init"),ht(),gi(),REDIPS.event.add(window,"resize",gi),i=k.getElementsByTagName("img"),t=0;t<i.length;++t)REDIPS.event.add(i[t],"mousemove",wi),REDIPS.event.add(i[t],"touchmove",wi);REDIPS.event.add(window,"scroll",p)},wi=function(){return!1},ht=function(t){var u,h,f,e,c,s,l,r,o,i;for(n.length=0,f=t===undefined?k.getElementsByTagName("table"):document.querySelectorAll(t),r=0,i=0;r<f.length;++r)if(f[r].parentNode.id!=="redips_clone"&&!(f[r].className.indexOf("nolayout")>-1)){u=f[r].parentNode;h=0;do u.nodeName==="TD"&&++h,u=u.parentNode;while(u&&u!==k);for(n[i]=f[r],n[i].redips||(n[i].redips={}),n[i].redips.container=k,n[i].redips.nestedLevel=h,n[i].redips.idx=i,yi[i]=0,c=n[i].getElementsByTagName("td"),s=0,l=!1;s<c.length;++s)if(c[s].rowSpan>1){l=!0;break}n[i].redips.rowspan=l;++i}for(r=0,o=yt=1;r<n.length;++r)if(n[r].redips.nestedLevel===0){for(n[r].redips.nestedGroup=o,n[r].redips.sort=yt*100,e=n[r].getElementsByTagName("table"),i=0;i<e.length;++i)e[i].className.indexOf("nolayout")>-1||(e[i].redips.nestedGroup=o,e[i].redips.sort=yt*100+e[i].redips.nestedLevel);++o;++yt}},bi=function(r){var e=r||window.event,s,ct,et,h,it;if(this.redips.animated===!0||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),er=e.shiftKey,ct=e.which?e.which:e.button,ir(e)||!e.touches&&ct!==1))return!0;if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection&&document.selection.type==="Text")try{document.selection.empty()}catch(lt){}return(e.touches?(h=nt.x=e.touches[0].clientX,it=nt.y=e.touches[0].clientY):(h=nt.x=e.clientX,it=nt.y=e.clientY),ut.x=h,ut.y=it,ut.flag=!1,REDIPS.drag.objOld=c=t||this,REDIPS.drag.obj=t=this,pt=t.className.indexOf("clone")>-1?!0:!1,REDIPS.drag.tableSort&&cr(t),k!==t.redips.container&&(k=t.redips.container,ht()),t.className.indexOf("row")===-1?REDIPS.drag.mode=v="cell":(REDIPS.drag.mode=v="row",REDIPS.drag.obj=t=ii(t)),p(),pt||v!=="cell"||(t.style.zIndex=999),i=u=o=null,ot(),d=y=i,ft=w=u,st=g=o,REDIPS.drag.td.source=f.source=b("TD",t),REDIPS.drag.td.current=f.current=f.source,REDIPS.drag.td.previous=f.previous=f.source,v==="cell"?REDIPS.drag.event.clicked(f.current):REDIPS.drag.event.rowClicked(f.current),(i===null||u===null||o===null)&&(ot(),d=y=i,ft=w=u,st=g=o,i===null||u===null||o===null))?!0:(vi=a=!1,REDIPS.event.add(document,"mousemove",kt),REDIPS.event.add(document,"touchmove",kt),REDIPS.event.add(document,"mouseup",bt),REDIPS.event.add(document,"touchend",bt),t.setCapture&&t.setCapture(),i!==null&&u!==null&&o!==null&&(vt=nr(i,u,o)),et=rt(n[d],"position"),et!=="fixed"&&(et=rt(n[d].parentNode,"position")),s=tt(t,et),l=[it-s[0],s[1]-h,s[2]-it,h-s[3]],k.onselectstart=function(n){return e=n||window.event,ir(e)?void 0:(e.shiftKey&&document.selection.clear(),!1)},!1)},hr=function(){REDIPS.drag.event.dblClicked()},cr=function(t){var r,u,i;for(r=b("TABLE",t),u=r.redips.nestedGroup,i=0;i<n.length;++i)n[i].redips.nestedGroup===u&&(n[i].redips.sort=yt*100+n[i].redips.nestedLevel);n.sort(function(n,t){return t.redips.sort-n.redips.sort});++yt},ii=function(n,t){var i,e,r,h,o,c,u,f,s;if(n.nodeName==="DIV")return u=n,n=b("TR",n),n.redips===undefined&&(n.redips={}),n.redips.div=u,n;for(r=n,r.redips===undefined&&(r.redips={}),n=b("TABLE",n),pt&&a&&(u=r.redips.div,u.className=ai(u.className.replace("clone",""))),i=n.cloneNode(!0),pt&&a&&(u.className=u.className+" clone"),h=i.rows.length-1,o=t==="animated"?h===0?!0:!1:!0,f=h;f>=0;--f)if(f!==r.rowIndex){if(o===!0&&t===undefined)for(c=i.rows[f],s=0;s<c.cells.length;++s)if(c.cells[s].className.indexOf("rowhandler")>-1){o=!1;break}i.deleteRow(f)}return a||(r.redips.emptyRow=o),i.redips={},i.redips.container=n.redips.container,i.redips.sourceRow=r,br(r,i.rows[0]),tr(r,i.rows[0]),document.getElementById("redips_clone").appendChild(i),e=tt(r,"fixed"),i.style.position="fixed",i.style.top=e[0]+"px",i.style.left=e[3]+"px",i.style.width=e[1]-e[3]+"px",i},fr=function(r,u,e){var v=!1,y,h,s={},o={},l;l=function(n){var t;n.redips!==undefined&&n.redips.emptyRow?li(n,"empty",REDIPS.drag.style.rowEmptyColor):(t=b("TABLE",n),t.deleteRow(n.rowIndex))};e===undefined?e=t:v=!0;s.row=e.redips.sourceRow;s.rowIndex=s.row.rowIndex;s.table=b("TABLE",s.row);s.tableSection=s.table.rows[0].parentNode;o.table=n[r];o.row=o.table.rows[u];o.rowIndex=u;o.tableSection=o.table.rows[0].parentNode;h=e.getElementsByTagName("tr")[0];e.parentNode.removeChild(e);y=REDIPS.drag.event.rowDroppedBefore(s.table,s.rowIndex);y!==!1&&(!v&&f.target.className.indexOf(REDIPS.drag.trash.className)>-1?a?REDIPS.drag.event.rowDeleted():REDIPS.drag.trash.questionRow?confirm(REDIPS.drag.trash.questionRow)?(l(s.row),REDIPS.drag.event.rowDeleted()):(delete c.redips.emptyRow,REDIPS.drag.event.rowUndeleted()):(l(s.row),REDIPS.drag.event.rowDeleted()):(o.rowIndex<o.table.rows.length?i===d?s.rowIndex>o.rowIndex?o.tableSection.insertBefore(h,o.row):o.tableSection.insertBefore(h,o.row.nextSibling):REDIPS.drag.rowDropMode==="after"?o.tableSection.insertBefore(h,o.row.nextSibling):o.tableSection.insertBefore(h,o.row):(o.tableSection.appendChild(h),o.row=o.table.rows[0]),o.row&&o.row.redips&&o.row.redips.emptyRow?o.tableSection.deleteRow(o.row.rowIndex):REDIPS.drag.rowDropMode==="overwrite"?l(o.row):REDIPS.drag.rowDropMode!=="switch"||a||(s.tableSection.insertBefore(o.row,s.row),s.row.redips!==undefined&&delete s.row.redips.emptyRow),(v||!a)&&l(s.row),delete h.redips.emptyRow,v||REDIPS.drag.event.rowDropped(h,s.table,s.rowIndex)),h.getElementsByTagName("table").length>0&&ht())},br=function(n,t){var o,u=[],f=[],i,r,e;for(u[0]=n.getElementsByTagName("input"),u[1]=n.getElementsByTagName("textarea"),u[2]=n.getElementsByTagName("select"),f[0]=t.getElementsByTagName("input"),f[1]=t.getElementsByTagName("textarea"),f[2]=t.getElementsByTagName("select"),i=0;i<u.length;++i)for(r=0;r<u[i].length;++r){o=u[i][r].type;switch(o){case"text":case"textarea":case"password":f[i][r].value=u[i][r].value;break;case"radio":case"checkbox":f[i][r].checked=u[i][r].checked;break;case"select-one":f[i][r].selectedIndex=u[i][r].selectedIndex;break;case"select-multiple":for(e=0;e<u[i][r].options.length;++e)f[i][r].options[e].selected=u[i][r].options[e].selected}}},bt=function(s){var pt=s||window.event,h,nt,tt,it,et,ot,b,rt,yt,l;if(et=pt.clientX,ot=pt.clientY,r.flag.x=r.flag.y=0,t.releaseCapture&&t.releaseCapture(),REDIPS.event.remove(document,"mousemove",kt),REDIPS.event.remove(document,"touchmove",kt),REDIPS.event.remove(document,"mouseup",bt),REDIPS.event.remove(document,"touchend",bt),k.onselectstart=null,di(t),e.width=document.documentElement.scrollWidth,e.height=document.documentElement.scrollHeight,r.flag.x=r.flag.y=0,a&&v==="cell"&&(i===null||u===null||o===null))t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(i===null||u===null||o===null)REDIPS.drag.event.notMoved();else{if(i<n.length?(h=n[i],REDIPS.drag.td.target=f.target=h.rows[u].cells[o],at(i,u,o,vt),nt=i,tt=u):y===null||w===null||g===null?(h=n[d],REDIPS.drag.td.target=f.target=h.rows[ft].cells[st],at(d,ft,st,vt),nt=d,tt=ft):(h=n[y],REDIPS.drag.td.target=f.target=h.rows[w].cells[g],at(y,w,g,vt),nt=y,tt=w),v==="row")if(vi)if(d===nt&&ft===tt){for(it=t.getElementsByTagName("tr")[0],c.style.backgroundColor=it.style.backgroundColor,l=0;l<it.cells.length;++l)c.cells[l].style.backgroundColor=it.cells[l].style.backgroundColor;t.parentNode.removeChild(t);delete c.redips.emptyRow;a?REDIPS.drag.event.rowNotCloned():REDIPS.drag.event.rowDroppedSource(f.target)}else fr(nt,tt);else REDIPS.drag.event.rowNotMoved();else if(a||ut.flag)if(a&&d===i&&ft===u&&st===o)t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(a&&REDIPS.drag.clone.drop===!1&&(et<h.redips.offset[3]||et>h.redips.offset[1]||ot<h.redips.offset[0]||ot>h.redips.offset[2]))t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(f.target.className.indexOf(REDIPS.drag.trash.className)>-1)t.parentNode.removeChild(t),REDIPS.drag.trash.question?setTimeout(function(){confirm(REDIPS.drag.trash.question)?ki():(a||(n[d].rows[ft].cells[st].appendChild(t),p()),REDIPS.drag.event.undeleted())},20):ki();else if(REDIPS.drag.dropMode==="switch")if(b=REDIPS.drag.event.droppedBefore(f.target),b===!1)dt(!1);else{for(t.parentNode.removeChild(t),rt=f.target.getElementsByTagName("div"),yt=rt.length,l=0;l<yt;++l)rt[0]!==undefined&&(REDIPS.drag.objOld=c=rt[0],f.source.appendChild(c),ct(c));dt();yt&&REDIPS.drag.event.switched()}else REDIPS.drag.dropMode==="overwrite"?(b=REDIPS.drag.event.droppedBefore(f.target),b!==!1&&ti(f.target),dt(b)):(b=REDIPS.drag.event.droppedBefore(f.target),dt(b));else REDIPS.drag.event.notMoved();v==="cell"&&t.getElementsByTagName("table").length>0&&ht();p();REDIPS.drag.event.finish()}y=w=g=null},dt=function(n){var u=null,r,i;if(n!==!1){if(gr.sendBack===!0){for(r=f.target.getElementsByTagName("DIV"),i=0;i<r.length;++i)if(t!==r[i]&&t.id.indexOf(r[i].id)===0){u=r[i];break}if(u){oi(u,1);t.parentNode.removeChild(t);return}}REDIPS.drag.dropMode==="shift"&&(kr(f.target)||REDIPS.drag.shift.after==="always")&&si(f.source,f.target);REDIPS.drag.multipleDrop==="top"&&f.target.hasChildNodes()?f.target.insertBefore(t,f.target.firstChild):f.target.appendChild(t);ct(t);REDIPS.drag.event.dropped(f.target);a&&(REDIPS.drag.event.clonedDropped(f.target),oi(c,-1))}else a&&t.parentNode&&t.parentNode.removeChild(t)},ct=function(n,t){t===!1?(n.onmousedown=null,n.ontouchstart=null,n.ondblclick=null):(n.onmousedown=bi,n.ontouchstart=bi,n.ondblclick=hr)},di=function(n){n.style.position="";n.style.zIndex="";n.style.top="";n.style.left="";n.style.width="";n.style.height=""},ki=function(){var n;if(a&&oi(c,-1),REDIPS.drag.dropMode==="shift"&&(REDIPS.drag.shift.after==="delete"||REDIPS.drag.shift.after==="always")){switch(REDIPS.drag.shift.mode){case"vertical2":n="lastInColumn";break;case"horizontal2":n="lastInRow";break;default:n="last"}si(f.source,rr(n,f.source)[2])}REDIPS.drag.event.deleted(a)},kt=function(n){var y=n||window.event,o=REDIPS.drag.scroll.bound,f,i,u,k,d,w,b;if(y.touches?(i=nt.x=y.touches[0].clientX,u=nt.y=y.touches[0].clientY):(i=nt.x=y.clientX,u=nt.y=y.clientY),k=Math.abs(ut.x-i),d=Math.abs(ut.y-u),vi||(v==="cell"&&(pt||REDIPS.drag.clone.keyDiv===!0&&er)?(REDIPS.drag.objOld=c=t,REDIPS.drag.obj=t=ei(t,!0),a=!0,REDIPS.drag.event.cloned(),gt()):(v==="row"&&((pt||REDIPS.drag.clone.keyRow===!0&&er)&&(a=!0),REDIPS.drag.objOld=c=t,REDIPS.drag.obj=t=ii(t),t.style.zIndex=999),t.setCapture&&t.setCapture(),t.style.width=t.offsetWidth+"px",t.style.height=t.offsetHeight+"px",t.style.position="fixed",p(),ot(),v==="row"&&(a?REDIPS.drag.event.rowCloned():REDIPS.drag.event.rowMoved()),gt()),i>h.width-l[1]&&(t.style.left=h.width-(l[1]+l[3])+"px"),u>h.height-l[2]&&(t.style.top=h.height-(l[0]+l[2])+"px")),vi=!0,v==="cell"&&(k>ut.value||d>ut.value)&&!ut.flag&&(ut.flag=!0,gt(),REDIPS.drag.event.moved(a)),i>l[3]&&i<h.width-l[1]&&(t.style.left=i-l[3]+"px"),u>l[0]&&u<h.height-l[2]&&(t.style.top=u-l[0]+"px"),i<it[1]&&i>it[3]&&u<it[2]&&u>it[0]&&r.flag.x===0&&r.flag.y===0&&(s.containTable||i<s[3]||i>s[1]||u<s[0]||u>s[2])&&(ot(),ri()),REDIPS.drag.scroll.enable)for(r.page.x=o-(h.width/2>i?i-l[3]:h.width-i-l[1]),r.page.x>0?(r.page.x>o&&(r.page.x=o),w=et()[0],r.page.x*=i<h.width/2?-1:1,r.page.x<0&&w<=0||r.page.x>0&&w>=e.width-h.width||r.flag.x++==0&&(REDIPS.event.remove(window,"scroll",p),ui(window))):r.page.x=0,r.page.y=o-(h.height/2>u?u-l[0]:h.height-u-l[2]),r.page.y>0?(r.page.y>o&&(r.page.y=o),w=et()[1],r.page.y*=u<h.height/2?-1:1,r.page.y<0&&w<=0||r.page.y>0&&w>=e.height-h.height||r.flag.y++==0&&(REDIPS.event.remove(window,"scroll",p),fi(window))):r.page.y=0,b=0;b<e.container.length;++b)if(f=e.container[b],f.autoscroll&&i<f.offset[1]&&i>f.offset[3]&&u<f.offset[2]&&u>f.offset[0]){r.div.x=o-(f.midstX>i?i-l[3]-f.offset[3]:f.offset[1]-i-l[1]);r.div.x>0?(r.div.x>o&&(r.div.x=o),r.div.x*=i<f.midstX?-1:1,r.flag.x++==0&&(REDIPS.event.remove(f.div,"scroll",p),ui(f.div))):r.div.x=0;r.div.y=o-(f.midstY>u?u-l[0]-f.offset[0]:f.offset[2]-u-l[2]);r.div.y>0?(r.div.y>o&&(r.div.y=o),r.div.y*=u<f.midstY?-1:1,r.flag.y++==0&&(REDIPS.event.remove(f.div,"scroll",p),fi(f.div))):r.div.y=0;break}else r.div.x=r.div.y=0;y.cancelBubble=!0;y.stopPropagation&&y.stopPropagation()},ri=function(){i<n.length&&(i!==y||u!==w||o!==g)&&(y!==null&&w!==null&&g!==null&&(at(y,w,g,vt),REDIPS.drag.td.previous=f.previous=n[y].rows[w].cells[g],REDIPS.drag.td.current=f.current=n[i].rows[u].cells[o],REDIPS.drag.dropMode==="switching"&&v==="cell"&&(ni(f.current,f.previous),p(),ot()),v==="cell"?REDIPS.drag.event.changed(f.current):v==="row"&&(i!==y||u!==w)&&REDIPS.drag.event.rowChanged(f.current)),gt())},gi=function(){typeof innerWidth=="number"?(h.width=window.innerWidth,h.height=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(h.width=document.documentElement.clientWidth,h.height=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(h.width=document.body.clientWidth,h.height=document.body.clientHeight);e.width=document.documentElement.scrollWidth;e.height=document.documentElement.scrollHeight;p()},ot=function(){var c,f,e,k,tt,p,b,it,rt,r=[],a,l,h;for(c=function(){y!==null&&w!==null&&g!==null&&(i=y,u=w,o=g)},a=nt.x,l=nt.y,i=0;i<n.length;++i)if(n[i].redips.enabled!==!1&&(r[0]=n[i].redips.offset[0],r[1]=n[i].redips.offset[1],r[2]=n[i].redips.offset[2],r[3]=n[i].redips.offset[3],n[i].sca!==undefined&&(r[0]=r[0]>n[i].sca.offset[0]?r[0]:n[i].sca.offset[0],r[1]=r[1]<n[i].sca.offset[1]?r[1]:n[i].sca.offset[1],r[2]=r[2]<n[i].sca.offset[2]?r[2]:n[i].sca.offset[2],r[3]=r[3]>n[i].sca.offset[3]?r[3]:n[i].sca.offset[3]),r[3]<a&&a<r[1]&&r[0]<l&&l<r[2])){for(e=n[i].redips.row_offset,u=0;u<e.length-1;++u)if(e[u]!==undefined){if(s[0]=e[u][0],e[u+1]!==undefined)s[2]=e[u+1][0];else for(h=u+2;h<e.length;++h)if(e[h]!==undefined){s[2]=e[h][0];break}if(l<=s[2])break}k=u;u===e.length-1&&(s[0]=e[u][0],s[2]=n[i].redips.offset[2]);do for(tt=n[i].rows[u].cells.length-1,o=tt;o>=0;--o)if(s[3]=e[u][3]+n[i].rows[u].cells[o].offsetLeft,s[1]=s[3]+n[i].rows[u].cells[o].offsetWidth,s[3]<=a&&a<=s[1])break;while(n[i].redips.rowspan&&o===-1&&u-->0);if(u<0||o<0?c():u!==k&&(s[0]=e[u][0],s[2]=s[0]+n[i].rows[u].cells[o].offsetHeight,(l<s[0]||l>s[2])&&c()),f=n[i].rows[u].cells[o],s.containTable=f.childNodes.length>0&&f.getElementsByTagName("table").length>0?!0:!1,f.className.indexOf(REDIPS.drag.trash.className)===-1)if(it=f.className.indexOf(REDIPS.drag.only.cname)>-1?!0:!1,it===!0){if(f.className.indexOf(pi.div[t.id])===-1){c();break}}else if(pi.div[t.id]!==undefined&&pi.other==="deny"){c();break}else if(b=f.className.indexOf(REDIPS.drag.mark.cname)>-1?!0:!1,(b===!0&&REDIPS.drag.mark.action==="deny"||b===!1&&REDIPS.drag.mark.action==="allow")&&f.className.indexOf(dr.exception[t.id])===-1){c();break}if(rt=f.className.indexOf("single")>-1?!0:!1,v==="cell"){if((REDIPS.drag.dropMode==="single"||rt)&&f.childNodes.length>0){if(f.childNodes.length===1&&f.firstChild.nodeType===3)break;for(p=!0,h=f.childNodes.length-1;h>=0;--h)if(f.childNodes[h].className&&f.childNodes[h].className.indexOf("drag")>-1){p=!1;break}if(!p&&y!==null&&w!==null&&g!==null&&(d!==i||ft!==u||st!==o)){c();break}}if(f.className.indexOf("rowhandler")>-1){c();break}if(f.parentNode.redips&&f.parentNode.redips.emptyRow){c();break}}break}},gt=function(){i<n.length&&i!==null&&u!==null&&o!==null&&(vt=nr(i,u,o),at(i,u,o),y=i,w=u,g=o)},at=function(t,r,f,e){var h,o,s;if(v==="cell"&&ut.flag)o=n[t].rows[r].cells[f].style,o.backgroundColor=e===undefined?REDIPS.drag.hover.colorTd:e.color[0].toString(),REDIPS.drag.hover.borderTd!==undefined&&(e===undefined?o.border=REDIPS.drag.hover.borderTd:(o.borderTopWidth=e.top[0][0],o.borderTopStyle=e.top[0][1],o.borderTopColor=e.top[0][2],o.borderRightWidth=e.right[0][0],o.borderRightStyle=e.right[0][1],o.borderRightColor=e.right[0][2],o.borderBottomWidth=e.bottom[0][0],o.borderBottomStyle=e.bottom[0][1],o.borderBottomColor=e.bottom[0][2],o.borderLeftWidth=e.left[0][0],o.borderLeftStyle=e.left[0][1],o.borderLeftColor=e.left[0][2]));else if(v==="row")for(h=n[t].rows[r],s=0;s<h.cells.length;++s)o=h.cells[s].style,o.backgroundColor=e===undefined?REDIPS.drag.hover.colorTr:e.color[s].toString(),REDIPS.drag.hover.borderTr!==undefined&&(e===undefined?i===d?u<ft?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:REDIPS.drag.rowDropMode==="before"?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:(o.borderTopWidth=e.top[s][0],o.borderTopStyle=e.top[s][1],o.borderTopColor=e.top[s][2],o.borderBottomWidth=e.bottom[s][0],o.borderBottomStyle=e.bottom[s][1],o.borderBottomColor=e.bottom[s][2]))},nr=function(t,i,r){var s,u,f={color:[],top:[],right:[],bottom:[],left:[]},o=function(n,t){var i="border"+t+"Width",r="border"+t+"Style",u="border"+t+"Color";return[rt(n,i),rt(n,r),rt(n,u)]},e;if(v==="cell")u=n[t].rows[i].cells[r],f.color[0]=u.style.backgroundColor,REDIPS.drag.hover.borderTd!==undefined&&(f.top[0]=o(u,"Top"),f.right[0]=o(u,"Right"),f.bottom[0]=o(u,"Bottom"),f.left[0]=o(u,"Left"));else for(s=n[t].rows[i],e=0;e<s.cells.length;++e)u=s.cells[e],f.color[e]=u.style.backgroundColor,REDIPS.drag.hover.borderTr!==undefined&&(f.top[e]=o(u,"Top"),f.bottom[e]=o(u,"Bottom"));return f},tt=function(n,t,i){var f,r=0,u=0,e=n;if(t!=="fixed"&&(f=et(),r=0-f[0],u=0-f[1]),i===undefined||i===!0){do r+=n.offsetLeft-n.scrollLeft,u+=n.offsetTop-n.scrollTop,n=n.offsetParent;while(n&&n.nodeName!=="BODY")}else do r+=n.offsetLeft,u+=n.offsetTop,n=n.offsetParent;while(n&&n.nodeName!=="BODY");return[u,r+e.offsetWidth,u+e.offsetHeight,r]},p=function(){for(var u,f,i,r,t=0;t<n.length;++t){for(f=[],i=rt(n[t],"position"),i!=="fixed"&&(i=rt(n[t].parentNode,"position")),u=n[t].rows.length-1;u>=0;--u)n[t].rows[u].style.display!=="none"&&(f[u]=tt(n[t].rows[u],i));n[t].redips.offset=tt(n[t],i);n[t].redips.row_offset=f}for(it=tt(k),t=0;t<e.container.length;++t)i=rt(e.container[t].div,"position"),r=tt(e.container[t].div,i,!1),e.container[t].offset=r,e.container[t].midstX=(r[1]+r[3])/2,e.container[t].midstY=(r[0]+r[2])/2},et=function(){var n,t;return typeof pageYOffset=="number"?(n=window.pageXOffset,t=window.pageYOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(n=document.body.scrollLeft,t=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?(n=document.documentElement.scrollLeft,t=document.documentElement.scrollTop):n=t=0,[n,t]},ui=function(n){var f,a,u,o,i,c=nt.x,l=nt.y;r.flag.x>0&&(p(),ot(),c<it[1]&&c>it[3]&&l<it[2]&&l>it[0]&&ri());typeof n=="object"&&(e.obj=n);e.obj===window?(u=a=et()[0],o=e.width-h.width,i=r.page.x):(u=e.obj.scrollLeft,o=e.obj.scrollWidth-e.obj.clientWidth,i=r.div.x);r.flag.x>0&&(i<0&&u>0||i>0&&u<o)?(e.obj===window?(window.scrollBy(i,0),u=et()[0],f=parseInt(t.style.left,10),isNaN(f)&&(f=0)):e.obj.scrollLeft+=i,setTimeout(ui,REDIPS.drag.scroll.speed)):(REDIPS.event.add(e.obj,"scroll",p),r.flag.x=0,s=[0,0,0,0])},fi=function(n){var f,a,u,o,i,c=nt.x,l=nt.y;r.flag.y>0&&(p(),ot(),c<it[1]&&c>it[3]&&l<it[2]&&l>it[0]&&ri());typeof n=="object"&&(e.obj=n);e.obj===window?(u=a=et()[1],o=e.height-h.height,i=r.page.y):(u=e.obj.scrollTop,o=e.obj.scrollHeight-e.obj.clientHeight,i=r.div.y);r.flag.y>0&&(i<0&&u>0||i>0&&u<o)?(e.obj===window?(window.scrollBy(0,i),u=et()[1],f=parseInt(t.style.top,10),isNaN(f)&&(f=0)):e.obj.scrollTop+=i,setTimeout(fi,REDIPS.drag.scroll.speed)):(REDIPS.event.add(e.obj,"scroll",p),r.flag.y=0,s=[0,0,0,0])},ei=function(n,t){var i=n.cloneNode(!0),r=i.className,u,f;return t===!0&&(document.getElementById("redips_clone").appendChild(i),i.style.zIndex=999,i.style.position="fixed",u=tt(n),f=tt(i),i.style.top=u[0]-f[0]+"px",i.style.left=u[3]-f[3]+"px"),i.setCapture&&i.setCapture(),r=r.replace("clone",""),r=r.replace(/climit(\d)_(\d+)/,""),i.className=ai(r),lt[n.id]===undefined&&(lt[n.id]=0),i.id=n.id+"c"+lt[n.id],lt[n.id]+=1,tr(n,i),i},tr=function(n,t){var i=[],r;i[0]=function(n,t){n.redips&&(t.redips={},t.redips.enabled=n.redips.enabled,t.redips.container=n.redips.container,n.redips.enabled&&ct(t))};i[1]=function(n,t){n.redips&&(t.redips={},t.redips.emptyRow=n.redips.emptyRow)};r=function(r){var e,f,o=["DIV","TR"],u;for(e=n.getElementsByTagName(o[r]),f=t.getElementsByTagName(o[r]),u=0;u<f.length;++u)i[r](e[u],f[u])};n.nodeName==="DIV"?i[0](n,t):n.nodeName==="TR"&&i[1](n,t);r(0);r(1)},oi=function(n,t){var u,f,r,i;i=n.className;u=i.match(/climit(\d)_(\d+)/);u!==null&&(f=parseInt(u[1],10),r=parseInt(u[2],10),r===0&&t===1&&(i+=" clone",f===2&&wt(!0,n)),r+=t,i=i.replace(/climit\d_\d+/g,"climit"+f+"_"+r),r<=0&&(i=i.replace("clone",""),f===2?(wt(!1,n),REDIPS.drag.event.clonedEnd2()):REDIPS.drag.event.clonedEnd1()),n.className=ai(i))},ir=function(n){var t=!1,i,r;n.srcElement?(i=n.srcElement.nodeName,r=n.srcElement.className):(i=n.target.nodeName,r=n.target.className);switch(i){case"A":case"INPUT":case"SELECT":case"OPTION":case"TEXTAREA":t=!0;break;default:t=/\bnodrag\b/i.test(r)?!0:!1}return t},wt=function(n,t){var i=[],c=[],l,f,a,v,y,o,u,w,r,s,h;for(f=REDIPS.drag.style.opacityDisabled,n===!0||n==="init"?(l=REDIPS.drag.style.borderEnabled,a="move",o=!0):(l=REDIPS.drag.style.borderDisabled,a="auto",o=!1),t===undefined?i=k.getElementsByTagName("div"):typeof t=="string"?i=document.querySelectorAll(t):typeof t=="object"&&(t.nodeName!=="DIV"||t.className.indexOf("drag")===-1)?i=t.getElementsByTagName("div"):i[0]=t,r=0,s=0;r<i.length;++r)if(/\bdrag\b/i.test(i[r].className))n==="init"||i[r].redips===undefined?(i[r].redips={},i[r].redips.container=k):n===!0&&typeof f=="number"?(i[r].style.opacity="",i[r].style.filter=""):n===!1&&typeof f=="number"&&(i[r].style.opacity=f/100,i[r].style.filter="alpha(opacity="+f+")"),ct(i[r],o),i[r].redips.enabled=o;else if(n==="init"&&(v=rt(i[r],"overflow"),v!=="visible")){for(REDIPS.event.add(i[r],"scroll",p),w=rt(i[r],"position"),u=tt(i[r],w,!1),y=/\bnoautoscroll\b/i.test(i[r].className)?!1:!0,e.container[s]={div:i[r],offset:u,midstX:(u[1]+u[3])/2,midstY:(u[0]+u[2])/2,autoscroll:y},c=i[r].getElementsByTagName("table"),h=0;h<c.length;++h)c[h].sca=e.container[s];++s}},pr=function(n){var t;typeof n=="object"&&n.nodeName==="DIV"?n.parentNode.removeChild(n):typeof n=="string"&&(t=document.getElementById(n),t&&t.parentNode.removeChild(t))},sr=function(t,i){if(typeof i=="object"&&i.nodeName==="TABLE")i.redips.enabled=t;else for(var r=0;r<n.length;++r)n[r].className.indexOf(i)>-1&&(n[r].redips.enabled=t)},rt=function(n,t){var i;return n&&n.currentStyle?i=n.currentStyle[t]:n&&window.getComputedStyle&&(i=document.defaultView.getComputedStyle(n,null)[t]),i},b=function(n,t,i){for(t=t.parentNode,i===undefined&&(i=0);t&&t.nodeName!==n;)t=t.parentNode,t&&t.nodeName===n&&i>0&&(--i,t=t.parentNode);return t},rr=function(n,t){var u=b("TABLE",t),i,r,f;switch(n){case"firstInColumn":i=0;r=t.cellIndex;break;case"firstInRow":i=t.parentNode.rowIndex;r=0;break;case"lastInColumn":i=u.rows.length-1;r=t.cellIndex;break;case"lastInRow":i=t.parentNode.rowIndex;r=u.rows[i].cells.length-1;break;case"last":i=u.rows.length-1;r=u.rows[i].cells.length-1;break;default:i=r=0}return f=u.rows[i].cells[r],[i,r,f]},lr=function(n,t){var u="",h,c,e,f,s=[],l=REDIPS.drag.saveParamName,i,r,o;if(typeof n=="string"&&(n=document.getElementById(n)),n!==undefined&&typeof n=="object"&&n.nodeName==="TABLE"){for(h=n.rows.length,i=0;i<h;++i)for(c=n.rows[i].cells.length,r=0;r<c;++r)if(e=n.rows[i].cells[r],e.childNodes.length>0)for(o=0;o<e.childNodes.length;++o)f=e.childNodes[o],f.nodeName==="DIV"&&f.className.indexOf("drag")>-1&&(u+=l+"[]="+f.id+"_"+i+"_"+r+"&",s.push([f.id,i,r]));u=t==="json"&&s.length>0?JSON.stringify(s):u.substring(0,u.length-1)}return u},ni=function(n,t,i){var o,s,e,u,h,r,f;if((h=function(n,t){REDIPS.drag.event.relocateBefore(n,t);var i=REDIPS.drag.getPosition(t);REDIPS.drag.moveObject({obj:n,target:i,callback:function(n){var i=REDIPS.drag.findParent("TABLE",n),r=i.redips.idx;REDIPS.drag.event.relocateAfter(n,t);--yi[r];yi[r]===0&&(REDIPS.drag.event.relocateEnd(),REDIPS.drag.enableTable(!0,i))}})},n!==t)&&typeof n=="object"&&typeof t=="object")if(e=n.childNodes.length,i==="animation"){if(e>0)for(o=b("TABLE",t),s=o.redips.idx,REDIPS.drag.enableTable(!1,o),r=0;r<e;++r)n.childNodes[r].nodeType===1&&n.childNodes[r].nodeName==="DIV"&&(++yi[s],h(n.childNodes[r],t))}else for(r=0,f=0;r<e;++r)n.childNodes[f].nodeType===1&&n.childNodes[f].nodeName==="DIV"?(u=n.childNodes[f],REDIPS.drag.event.relocateBefore(u,t),t.appendChild(u),u.redips&&u.redips.enabled!==!1&&ct(u),REDIPS.drag.event.relocateAfter(u)):++f},ti=function(n,t){var r,u=[],i;if(n.nodeName==="TD"){if(r=n.childNodes.length,t==="test")return f.source===n?undefined:n.childNodes.length===0||n.childNodes.length===1&&n.firstChild.nodeType===3?!0:!1;for(i=0;i<r;++i)u.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);return u}},si=function(n,t){var l,r,i,h,e,it,rt,a,v,u,o,c,y,ft,p,w,k,s,d,g,nt=!1,tt,ut;if(tt=function(n,t){REDIPS.drag.shift.animation?ni(n,t,"animation"):ni(n,t)},ut=function(n){REDIPS.drag.shift.overflow==="delete"?ti(n):REDIPS.drag.shift.overflow==="source"?tt(n,f.source):typeof REDIPS.drag.shift.overflow=="object"&&tt(n,REDIPS.drag.shift.overflow);nt=!1;REDIPS.drag.event.shiftOverflow(n)},n!==t){p=REDIPS.drag.shift.mode;l=b("TABLE",n);r=b("TABLE",t);rt=ar(r);h=l===r?[n.redips.rowIndex,n.redips.cellIndex]:[-1,-1];e=[t.redips.rowIndex,t.redips.cellIndex];w=r.rows.length;k=vr(r);switch(p){case"vertical2":i=l===r&&n.redips.cellIndex===t.redips.cellIndex?h:[w,t.redips.cellIndex];break;case"horizontal2":i=l===r&&n.parentNode.rowIndex===t.parentNode.rowIndex?h:[t.redips.rowIndex,k];break;default:i=l===r?h:[w,k]}for(p==="vertical1"||p==="vertical2"?(it=i[1]*1e3+i[0]<e[1]*1e3+e[0]?1:-1,g=w,s=0,d=1):(it=i[0]*1e3+i[1]<e[0]*1e3+e[1]?1:-1,g=k,s=1,d=0),i[0]!==h[0]&&i[1]!==h[1]&&(nt=!0);i[0]!==e[0]||i[1]!==e[1];)if(v=rt[i[0]+"-"+i[1]],i[s]+=it,i[s]<0?(i[s]=g,--i[d]):i[s]>g&&(i[s]=0,++i[d]),a=rt[i[0]+"-"+i[1]],a!==undefined&&(u=a),v!==undefined&&(o=v),a!==undefined&&o!==undefined||u!==undefined&&v!==undefined){if(c=u.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,y=o.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,nt&&c===0&&y===1&&ut(u),c===1){y===0&&(ft=o);continue}else c===0&&y===1&&(o=ft);tt(u,o)}else nt&&u!==undefined&&o===undefined&&(c=u.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,c===0&&ut(u))}},ar=function(n){for(var u=[],c,l={},i,r,a,v,f,s,t,h,o=n.rows,e=0;e<o.length;++e)for(s=0;s<o[e].cells.length;++s){for(i=o[e].cells[s],r=i.parentNode.rowIndex,a=i.rowSpan||1,v=i.colSpan||1,u[r]=u[r]||[],t=0;t<u[r].length+1;++t)if(typeof u[r][t]=="undefined"){f=t;break}for(l[r+"-"+f]=i,i.redips===undefined&&(i.redips={}),i.redips.rowIndex=r,i.redips.cellIndex=f,t=r;t<r+a;++t)for(u[t]=u[t]||[],c=u[t],h=f;h<f+v;++h)c[h]="x"}return l},vr=function(n){var u=n.rows,i,f=0,t,r;for(typeof n=="string"&&(n=document.getElementById(n)),t=0;t<u.length;++t){for(i=0,r=0;r<u[t].cells.length;++r)i+=u[t].cells[r].colSpan||1;i>f&&(f=i)}return f},yr=function(t){var i={direction:1},f,e,p,w,o,s,v,y,h,d,l,a,r,u;if(i.callback=t.callback,i.overwrite=t.overwrite,typeof t.id=="string"?i.obj=i.objOld=document.getElementById(t.id):typeof t.obj=="object"&&t.obj.nodeName==="DIV"&&(i.obj=i.objOld=t.obj),t.mode==="row"){if(i.mode="row",u=hi(t.source[0]),h=t.source[1],c=i.objOld=n[u].rows[h],c.redips&&c.redips.emptyRow===!0)return!1;i.obj=ii(i.objOld,"animated")}else if(i.obj&&i.obj.className.indexOf("row")>-1){if(i.mode="row",i.obj=i.objOld=c=b("TR",i.obj),c.redips&&c.redips.emptyRow===!0)return!1;i.obj=ii(i.objOld,"animated")}else i.mode="cell";if(typeof i.obj=="object"&&i.obj!==null)return i.obj.style.zIndex=999,i.obj.redips&&k!==i.obj.redips.container&&(k=i.obj.redips.container,ht()),r=tt(i.obj),p=r[1]-r[3],w=r[2]-r[0],f=r[3],e=r[0],t.clone===!0&&i.mode==="cell"&&(i.obj=ei(i.obj,!0),REDIPS.drag.event.cloned(i.obj)),t.target===undefined?t.target=ci():typeof t.target=="object"&&t.target.nodeName==="TD"&&(t.target=ci(t.target)),i.target=t.target,u=hi(t.target[0]),h=t.target[1],d=t.target[2],h>n[u].rows.length-1&&(h=n[u].rows.length-1),i.targetCell=n[u].rows[h].cells[d],i.mode==="cell"?(r=tt(i.targetCell),v=r[1]-r[3],y=r[2]-r[0],o=r[3]+(v-p)/2,s=r[0]+(y-w)/2):(r=tt(n[u].rows[h]),v=r[1]-r[3],y=r[2]-r[0],o=r[3],s=r[0]),l=o-f,a=s-e,i.obj.style.width=i.obj.offsetWidth+"px",i.obj.style.height=i.obj.offsetHeight+"px",i.obj.style.position="fixed",Math.abs(l)>Math.abs(a)?(i.type="horizontal",i.m=a/l,i.b=e-i.m*f,i.k1=(f+o)/(f-o),i.k2=2/(f-o),f>o&&(i.direction=-1),u=f,i.last=o):(i.type="vertical",i.m=l/a,i.b=f-i.m*e,i.k1=(e+s)/(e-s),i.k2=2/(e-s),e>s&&(i.direction=-1),u=e,i.last=s),i.obj.redips&&(i.obj.redips.animated=!0),ur(u,i),[i.obj,i.objOld]},ur=function(n,t){var r=(t.k1-t.k2*n)*(t.k1-t.k2*n),i;n=n+REDIPS.drag.animation.step*(4-r*3)*t.direction;i=t.m*n+t.b;t.type==="horizontal"?(t.obj.style.left=n+"px",t.obj.style.top=i+"px"):(t.obj.style.left=i+"px",t.obj.style.top=n+"px");n<t.last&&t.direction>0||n>t.last&&t.direction<0?setTimeout(function(){ur(n,t)},REDIPS.drag.animation.pause*r):(di(t.obj),t.obj.redips&&(t.obj.redips.animated=!1),t.mode==="cell"?(t.overwrite===!0&&ti(t.targetCell),t.targetCell.appendChild(t.obj),t.obj.redips&&t.obj.redips.enabled!==!1&&ct(t.obj)):fr(hi(t.target[0]),t.target[1],t.obj),typeof t.callback=="function"&&t.callback(t.obj))},ci=function(t){var c,l,f,e,s,r,a,h=[];return f=e=s=-1,t===undefined?(c=i<n.length?n[i].redips.idx:y===null||w===null||g===null?n[d].redips.idx:n[y].redips.idx,l=n[d].redips.idx,h=[c,u,o,l,ft,st]):(r=typeof t=="string"?document.getElementById(t):t,r&&(r.nodeName!=="TD"&&(r=b("TD",r)),r&&r.nodeName==="TD"&&(f=r.cellIndex,e=r.parentNode.rowIndex,a=b("TABLE",r),s=a.redips.idx)),h=[s,e,f]),h},hi=function(t){for(var i=0;i<n.length;++i)if(n[i].redips.idx===t)break;return i},ai=function(n){return n!==undefined&&(n=n.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ")),n},kr=function(n){for(var t=0;t<n.childNodes.length;++t)if(n.childNodes[t].nodeType===1)return!0;return!1},li=function(n,t,i){var u,r,f;if(typeof n=="string"&&(n=document.getElementById(n),n=b("TABLE",n)),n.nodeName==="TR")for(u=n.getElementsByTagName("td"),r=0;r<u.length;++r)if(u[r].style.backgroundColor=i?i:"",t==="empty")u[r].innerHTML="";else for(f=0;f<u[r].childNodes.length;++f)u[r].childNodes[f].nodeType===1&&(u[r].childNodes[f].style.opacity=t/100,u[r].childNodes[f].style.filter="alpha(opacity="+t+")");else n.style.opacity=t/100,n.style.filter="alpha(opacity="+t+")",n.style.backgroundColor=i?i:""},wr=function(n,t,i){var u=document.getElementById(n),r=u.rows[t];i===undefined&&(i=REDIPS.drag.style.rowEmptyColor);r.redips===undefined&&(r.redips={});r.redips.emptyRow=!0;li(r,"empty",i)},{obj:t,objOld:c,mode:v,td:f,hover:{colorTd:"#83bfe7",colorTr:"#83bfe7"},scroll:{enable:!0,bound:25,speed:20},only:pi,mark:dr,style:{borderEnabled:"solid",borderDisabled:"solid",opacityDisabled:"",rowEmptyColor:"#fff"},trash:{className:"trash",question:null,questionRow:null},saveParamName:"p",dropMode:"multiple",multipleDrop:"bottom",clone:gr,animation:{pause:20,step:2,shift:!1},shift:{mode:"horizontal1",after:"default",overflow:"bunch"},rowDropMode:"before",tableSort:!0,init:or,initTables:ht,enableDrag:wt,enableTable:sr,cloneObject:ei,saveContent:lr,relocate:ni,emptyCell:ti,moveObject:yr,shiftCells:si,deleteObject:pr,getPosition:ci,rowOpacity:li,rowEmpty:wr,getScrollPosition:et,getStyle:rt,findParent:b,findCell:rr,event:nu}}();REDIPS.event||(REDIPS.event=function(){var n,t;return n=function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent?n.attachEvent("on"+t,i):n["on"+t]=i},t=function(n,t,i){n.removeEventListener?n.removeEventListener(t,i,!1):n.detachEvent?n.detachEvent("on"+t,i):n["on"+t]=null},{add:n,remove:t}}());g_boardm=new BonusesLayout;g_bui=new RedipsUI;const DEBUG=!1;var g_boardwidth=15,g_boardheight=15,g_racksize=8,g_animation=0,g_wait=500,g_board,g_boardpoints,g_boardtypes,g_boardmults,g_letpool,g_letscore,g_matches_cache,g_pscore,g_oscore,g_passes,g_board_empty,g_opponent_has_joker,g_maxpasses=2,g_lmults=[1,2,3,1,1],g_wmults=[1,1,1,2,3],g_allLettersBonus=50,g_playlevel=g_bui.getPlayLevel(),g_maxwpoints=[10,20,30,40,50,75,100,125,250,500],g_wstr=[];(function(){var t=[];for(var n in g_wordmap)n.length>15||(t[n.length-2]||(t[n.length-2]=[]),t[n.length-2].push(n));for(n=0;n<t.length;++n)t[n]&&g_wstr.push("_"+t[n].join("_")+"_")})();gCloneFunc=typeof Object.create=="function"?Object.create:function(n){var t={};for(var i in n)t[i]=n[i];return t};gErrPrefix=function(){var n=["Oops","Sorry","Whoops"];return localStorage.lang==="vi"?t("Sorry, "):n[randInt(0,n.length-1)]+", "};window.init=init;window.onload=function(){if(g_cache={app:el("app"),modalMask:el("modal-mask"),modalContainer:el("modal-container"),modalInner:el("modal-inner"),modalContent:el("modal-content"),sound:el("sound"),html:{}},g_isSupported)localStorage.session?load(localStorage.session):init("board"),g_cache.modalMask.addEventListener("click",closeModal),g_cache.modalInner.addEventListener("click",handleHideModal),el("score-opponent").addEventListener("click",showGameInfo),el("score-player").addEventListener("click",showGameInfo),el("back").addEventListener("click",hideGameInfo),document.documentElement.classList.replace("loading","loaded"),document.dispatchEvent(new Event("appReady"));else{var n=["&#9785;","&#128530;","&#128546;","&#128528;","&#128527;","&#128529;","&#128532;","&#128533;","&#128542;","&#128543;","&#128550;","&#128551;"];g_cache.app.innerHTML="<p><strong>"+n[randInt(0,n.length-1)]+"</strong><br><br>"+gErrPrefix()+t("this browser is not supported. Please upgrade to a modern browser.")+"</p>";document.documentElement.className="loaded error";gtag("event",navigator.userAgent,{event_category:"Unsupported Browser"})}};g_isSupported&&(window.addEventListener("resize",debounce(toggleMobile)),document.addEventListener("keydown",handleKeyDown));const VER="1.29";document.addEventListener("appReady",function(){(VER>localStorage.ver||!localStorage.ver)&&(showWhatsNew(),localStorage.ver=VER)});