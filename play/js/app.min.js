"use strict";
/*!
 * Copyright (c) 2008-2011, www.redips.net All rights reserved.
 * Code licensed under the BSD License: http://www.redips.net/license/
 * http://www.redips.net/javascript/drag-and-drop-table-content/
 * Version 5.0.5
 * Dec 27, 2012.
 */
function BonusesLayout(){var n=this;n.boardm=[];n.init=function(t,i){var e,o,r,u,f;for(n.bx=t,n.by=i,r=0;r<t;++r)for(n.boardm[r]=[],u=0;u<i;++u)n.boardm[r][u]=0;for(e=Math.floor(t/2),o=Math.floor(i/2),r=0;r<e;++r)for(u=0;u<o;++u)f=t*i-r-u,f%8==0?n.setquad(r,u,1):f%11==0?n.setquad(r,u,2):f%7==0&&n.setquad(r,u,3);return n.setquad(e,0,3),n.setquad(0,o,3),n.setquad(4,0,4),n.setquad(0,1,4),n.setquad(4,4,0),n.setquad(1,2,0),n.setquad(2,1,0),n.setquad(1,1,3),n.setquad(4,1,0),n.setquad(6,5,2),n.setquad(8,2,0),n.setquad(2,6,0),n.setquad(4,7,3),g_boardmults=n.boardm,n.boardm};n.setquad=function(t,i,r){var u=t,f=i,e=n.bx-t-1,o=n.by-i-1;n.boardm[u][f]=r;n.boardm[u][o]=r;n.boardm[e][f]=r;n.boardm[e][o]=r}}function cb(n){g_def=n.result}function el(n){return document.getElementById(n)||document.querySelector(n)}function getJsonp(n,t){var u,f=Date.now(),r="handleJsonp"+f,e="getjson-"+f,o=function(){el(e).remove();delete window[r]},i=document.createElement("script");i.id=e;i.src=n.replace(/=\?/,"="+r);i.onload=function(){typeof t=="function"&&t(u);o()};i.onerror=function(){console.warn("Error retrieving data from "+n);o()};window[r]=function(n){u=n};document.head.appendChild(i)}function randFloat(n,t,i){return parseFloat(Math.min(n+Math.random()*(t-n),t).toFixed(i||0))}function randInt(n,t){return Math.floor(Math.random()*(t-n+1)+n)}function setLang(n){var i=confirm(t("This will restart the game."));i&&(setStorage("lang",n),gtag("event",n,{event_category:"Language"}),location.reload())}function setTileset(n){var i=confirm(t("This will restart the game."));i?(setStorage("tileset",n.value),gtag("event",n.value,{event_category:"Tileset"}),location.reload()):n.selectedIndex=0}function showModal(n,t){g_cache.modalContent.innerHTML=n;g_cache.modalMask.style.display="block";parseFloat(t)&&(g_cache.modalContainer.style.width=t+"px");g_cache.modalContainer.style.display="block";g_cache.modalContainer.style.marginTop="-"+(g_cache.modalContainer.clientHeight-13)/2+"px";setTimeout(function(){var n=g_cache.modalContent.querySelector("input, button");n&&n.focus();g_cache.modalMask.classList.add("on");g_cache.modalContainer.classList.add("on")},0);[].forEach.call(g_cache.app.querySelectorAll("a[href], button"),function(n){n.tabIndex=-1})}function hideModal(){g_cache.modalContainer.classList.remove("on");g_cache.modalMask.classList.remove("on");g_bui.timer=setTimeout(function(){g_cache.modalContainer.style.display="none";g_cache.modalMask.style.display="none"},300);[].forEach.call(g_cache.app.querySelectorAll("a[href], button"),function(n){n.tabIndex=0})}function RedipsUI(){var n=this;n.created=!1;n.plrRackId="pl";n.oppRackId="op";n.boardId="c";n.newplays={};n.racks=[];n.racks[1]=[];n.racks[2]=[];n.firstrack=!0;n.level=getStorage("level")||1;n.hlines="";n.hcount=0;n.showOpRack=1;n.acceptPlayerPlacement=function(){n.newplays={};n.makeTilesFixed()};n.addToHistory=function(i,r){var u,f,e,o;for(r!==1&&r!==2&&(r=1),r=r-1,++n.hcount,u="<table>",f=0;f<i.length;++f)e=i[f],u+='<tr class="player-'+r+'">',u+="<td>"+e.toUpperCase()+"</td><td>",u+='<a class="link" title="'+t("Show definition")+'" aria-label="'+t("Show definition")+'" onclick="g_bui.wordInfo(\''+e+'\')"><img src="pics/info.svg" width="22" height="22" alt=""></a>',u+="</td></tr>";u+="</table>";n.hlines+=u;o=el("history");o.innerHTML=n.hlines;o.scrollTop=n.hcount*100;i.length>0&&setTimeout(function(){r===0?gtag("event","Player Move",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:i.join(", "),value:+el("lpscore").textContent}):gtag("event","Computer Move",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:i.join(", "),value:+el("loscore").textContent})},100)};n.animDone=function(){--n.animTiles;n.playSound();n.animTiles===0&&n.animCallback()};n.cancelPlayerPlacement=function(){for(var o,u,s,f,i,h=n.getPlayerPlacement(),e=[],r,t=0;t<h.length;++t)o=h[t],r=n.boardId+o.x+"_"+o.y,u=el(r),e.push(u.firstChild),u.holds="",u.innerHTML="";for(s=0,t=0;t<n.racksize;++t)r=n.plrRackId+t,f=el(r),f.holds===""&&s<e.length&&(i=e[s++],i.holds.points===0&&(i.innerHTML=""),f.appendChild(i),f.holds=n.hcopy(i.holds));n.newplays=[]};n.create=function(i,r,u,f,e){var a,v,y,w,c,b,k,o,h,d;if(!n.created){n.boardm=g_boardm.init(r,u);var p='<picture><source type="image/webp" srcset="pics/arrow.webp"><img src="pics/arrow.png" width="22" height="22" alt=""></picture>',l='<tr class="ruler"><td colspan="2"></td></tr>',s='<div id="board" class="human-computer"></div>';for(s+='<div id="score"><div class="container"><h1><img src="pics/icon.svg" alt=""> <span class="opponent">Viet</span><span class="player">board</span> <sup>beta</sup></h1><h2 class="heading">'+t("Words Played")+'</h2><div id="history"></div><table class="gameinfo">'+l+'<tr class="level"><td>'+t("Level:")+'</td><td><span id="level" title="'+t("Computer can score up to ")+g_maxwpoints[g_playlevel]+t(" points per turn")+'">'+(g_playlevel+1)+'</span>&nbsp;<a class="link up" title="'+t("Increase difficulty")+'" aria-label="'+t("Increase difficulty")+'" onclick="g_bui.levelUp()">'+p+'</a><a class="link down" title="'+t("Decrease difficulty")+'" aria-label="'+t("Decrease difficulty")+'" onclick="g_bui.levelDn()">'+p+"</a></td></tr>",a=g_tilesets.indexOf(g_tileset)>-1?g_tileset:t("Default"),v='<select title="'+a+'" onchange="setTileset(this)"><option>'+a+"</option>",a!==t("Default")&&(v+='<option value="default">'+t("Default")+"</option>"),o=0;o<g_tilesets.length;++o)g_tilesets[o]!==a&&(v+="<option>"+g_tilesets[o]+"</option>");for(v+="</select>",s+="<tr><td>"+t("Tileset:")+"</td><td>"+v+"</td></tr>"+l+"<tr><td>"+t("Computer&rsquo;s last score:")+'</td><td id="loscore">0</td></tr><tr class="highlight"><td>'+t("Computer&rsquo;s total score:")+'</td><td id="oscore">0</td></tr>'+l+"<tr><td>"+t("Your last score:")+'</td><td id="lpscore">0</td></tr><tr class="highlight"><td>'+t("Your total score:")+'</td><td id="pscore">0</td></tr>'+l+"<tr><td>"+t("Tiles left:")+'</td><td id="tleft"></td></tr>'+l+'</table><div id="footer">'+(getStorage("lang")==="vi"?"<a href=\"javascript:setLang('en')\">"+t("English")+"</a> | "+t("Vietnamese"):t("English")+" | <a href=\"javascript:setLang('vi')\">"+t("Vietnamese")+"</a>")+"<br>"+t("Feedback?")+' <a href="mailto:feedback@vietboard.org?subject=Vietboard">feedback@vietboard.org</a></div></div></div>',g_cache.app.innerHTML=s,n.scores=f,n.created=!0,n.racksize=e,n.bx=r,n.by=u,s='<div id="drag">',s+='<table class="opponent"><tr><td class="mark">',s+="</td>",o=0;o<e;++o)s+='<td id="'+n.oppRackId+o+'"></td>';for(s+="</tr></table>",y=n.getStartXY(),w=["","DL","TL","DW","TW"],s+='<table class="board">',o=0;o<u;++o){for(s+="<tr>",h=0;h<r;++h)s+='<td id="c'+h+"_"+o+'" ',c="",c=h===y.x&&o===y.y?"ST":w[n.boardm[h][o]],c!==""&&(c='class="'+c+'"'),s+=c+"></td>";s+="</tr>"}for(s+="</table>",s+='<table class="player"><tr>',o=0;o<e;++o)s+='<td id="'+n.plrRackId+o+'"></td>';for(s+='<td class="mark">',s+='<button class="button" onclick="onPlayerMoved(false)">'+t("Play")+"</button></td>",s+='<td class="mark">',s+='<button id="pass" class="obutton" onclick="onPlayerMoved(true)">'+t("Pass")+"</button></td>",s+='<td class="mark">',s+='<button class="obutton" onclick="onPlayerClear()">'+t("Clear")+"</button></td>",s+='<td class="mark">',s+='<button class="obutton" onclick="onPlayerSwap()">'+t("Swap")+"</button></td>",s+="</tr></table>",s+="</div>",el(i).innerHTML=s,o=0;o<e;++o)b=n.plrRackId+o,k=n.oppRackId+o,el(b).holds="",el(k).holds="";for(o=0;o<u;++o)for(h=0;h<r;++h)d=n.boardId+h+"_"+o,el(d).holds="";n.rd=REDIPS.drag;n.initRedips()}};n.fixPlayerTiles=function(){for(var r,i,t=0;t<n.racks[1].length;++t)r=n.plrRackId+t,i=el(r).firstChild,i&&n.rd.enableDrag(!1,i)};n.getBoard=function(){for(var i,r=[],u=[],t=0;t<n.bx;++t)for(r[t]=[],u[t]=[],i=0;i<n.by;++i){var s=n.boardId+t+"_"+i,f=el(s),e="",o=0;f.holds!==""&&(e=f.holds.letter,o=f.holds.points);r[t][i]=e;u[t][i]=o}return{board:r,boardp:u}};n.getOpponentRack=function(){return n.racks[2]};n.getPlayerPlacement=function(){var u=[],i=n.newplays,t,f,r;for(t in i)f=t.substr(1),r=f.split("_"),u.push({ltr:i[t].letter,lsc:i[t].points,x:+r[0],y:+r[1]});return u};n.getPlayerRack=function(){return n.racks[1]};n.getPlayLevel=function(){return n.level-1};n.getStartXY=function(){var t=Math.round(n.bx/2)-1,i=Math.round(n.by/2)-1;return{x:t,y:i}};n.hcopy=function(n){return n===undefined||n===""||n===null?"":{letter:n.letter,points:n.points}};n.initRedips=function(){n.rd.init();n.rd.dropMode="single";n.rd.animation.pause=g_animation;n.rd.event.dropped=function(){var t=n.hcopy(n.rd.obj.holds),i,r;if(n.rd.td.target.holds=t,i=n.rd.td.target.id,r=n.rd.td.source.id.charAt(0),i.charAt(0)===n.boardId){if(t!==""&&t.points===0&&r!==n.boardId){n.showLettersModal(i);return}n.newplays[i]=n.hcopy(t);n.playSound()}else i.charAt(0)==="p"&&t!==""&&t.points===0&&r===n.boardId&&(n.rd.obj.innerHTML="",n.rd.obj.holds={letter:"",points:0})};n.rd.event.moved=function(){n.rd.td.source.holds="";var t=n.rd.td.source.id;t.charAt(0)===n.boardId&&delete n.newplays[t]}};n.levelDn=function(){n.level>1&&--n.level;el("level").textContent=n.level;el("level").title=t("Computer can score up to ")+g_maxwpoints[n.level-1]+t(" points per turn");g_playlevel=n.level-1;setStorage("level",n.level)};n.levelUp=function(){n.level<g_maxwpoints.length&&++n.level;el("level").textContent=n.level;el("level").title=t("Computer can score up to ")+g_maxwpoints[n.level-1]+t(" points per turn");g_playlevel=n.level-1;setStorage("level",n.level)};n.makeTilesFixed=function(){var t,i;for(n.rd.enableDrag(!1,"#drag div"),t=0;t<n.racks[1].length;++t){var u=n.plrRackId+t,f=n.oppRackId+t,r=el(f).firstChild;r&&n.rd.enableDrag(!1,r);i=el(u).firstChild;i&&n.rd.enableDrag(!0,i)}};n.onSelLetter=function(t){var i={letter:t,points:0},r,u,f;n.newplays[n.bdropCellId]=i;r=el(n.bdropCellId);r.holds=n.hcopy(i);u="";u+=t.toUpperCase()+"<sup><small>&nbsp;</small></sup>";f=r.firstChild;f.holds=n.hcopy(i);f.innerHTML=u;hideModal()};n.onSwap=function(t){var r="",f="",u,i;if(t)r=n.getPlayerRack();else for(u=0;;++u){if(i=el("swap-candidate"+u),!i)break;i.firstChild&&(i.firstChild&&i.classList.contains("to-swap")?f+=i.firstChild.holds.letter:r+=i.firstChild.holds.letter)}hideModal();onPlayerSwapped(r,f)};n.playOpponentMove=function(t,i){function it(t,i){setTimeout(function(){n.rd.moveObject(t)},i)}function ft(n,t){return n.x-t.x}function et(n,t){return n.y-t.y}for(var c,u,k,v,f,h,p,w,d,b,g,o=n.racks[2],l=o,s={},r=0;r<t.length;++r)if(c=t[r],u=c.ltr,u in s?s[u].push(c):s[u]=[c],o.search(u)===-1){k=o.search("\\*");o=o.replace("*","_");l=l.replace("*",u);var nt=n.oppRackId+k,tt=el(nt),a='<div class="drag t2">'+u.toUpperCase();a+="<sup><small>&nbsp;</small></sup>";a+="</div>";tt.innerHTML=a}else o=o.replace(u,"_");for(n.displayedcells=[],v=l.split(""),n.fixPlayerTiles(),f=[],r=0;r<v.length;++r)if(h=v[r],h in s&&s[h].length>0){var e=s[h][0],rt=n.oppRackId+r,ut=n.boardId+e.x+"_"+e.y,y=el(rt);y.style.display="";n.displayedcells.push(y);p=y.firstChild;w=el(ut);p.holds={letter:e.ltr,points:e.ltscr};n.animTiles=t.length;n.animCallback=i;d={obj:p,target:w,callback:n.animDone};f.push({info:d,x:e.x,y:e.y});w.holds={letter:e.ltr,points:e.lscr};s[h].splice(0,1)}for(b=f.length,b>1&&(f[0].x!==f[1].x?f.sort(ft):f.sort(et)),r=0;r<b;++r)g=g_wait*r,it(f[r].info,g)};n.playSound=function(){g_cache.sound.play()};n.prompt=function(n,i){showModal(n+'<div class="buttons">'+(i||'<button class="button" onclick="hideModal()">'+t("OK")+"</button>")+"</div>")};n.removeFromOpponenentRack=function(t){n.removeFromRack(2,t)};n.removeFromPlayerRack=function(t){n.removeFromRack(1,t)};n.removeFromRack=function(t,i){for(var e,f,o,u={},r=0;r<i.length;++r)e=i.charAt(r),e in u?++u[e]:u[e]=1;for(f=n.racks[t].split(""),r=0;r<f.length;++r)o=f[r],o in u&&u[o]>0&&(delete f[r],--u[o]);n.racks[t]=f.join("")};n.setLetters=function(t,i){var r,c,u,f,o,l,s,a;n.racks[t]=i;var e=[],v=t===1?n.plrRackId:n.oppRackId,h="";for(r=0;r<i.length;++r)h+=i.charAt(r).toUpperCase();for(r=0;r<n.racksize;++r)c=v+r,u=el(c),u.firstChild&&u.removeChild(u.firstChild),f=r<i.length?i.charAt(r):"",f!==""?(e.push(u),o='<div class="drag t'+t+'">',l={letter:f,points:n.scores[f]},u.holds=l,f!=="*"&&(s=h.charAt(r),o+=(s===" "?"&nbsp;&nbsp;":s)+"<sup><small>"+n.scores[f]+"</small></sup>"),o+="</div>",u.innerHTML=o):u.holds="";for(r in e)a=e[r].firstChild,a.holds=n.hcopy(e[r].holds)};n.setPlayerRack=function(t){n.setLetters(1,t);n.firstrack&&(n.firstrack=!1,n.initRedips())};n.setPlayerScore=function(n,t){el("lpscore").textContent=n;el("pscore").textContent=t};n.setOpponentRack=function(t){n.setLetters(2,t)};n.setOpponentScore=function(n,t){el("loscore").textContent=n;el("oscore").textContent=t};n.setTilesLeft=function(n){el("tleft").textContent=n};n.showBusy=function(){showModal(t("Computer thinking, please wait..."))};n.showLettersModal=function(t){var u,r;n.bdropCellId=t;var f=6,e=g_letters.length,i="";for(r=0;r<e;++r)u=g_letters[r][0],u!=="*"&&(i!==""&&r%f==0&&(i+="</tr><tr>"),i+='<td><button class="obutton" onclick="g_bui.onSelLetter(\''+u+"')\">",i+=(u===" "?"&nbsp;":u.toUpperCase())+"</button></td>");for(r=e;(r-1)%f!=0;++r)i+="<td></td>";i='<table id="letters"><tr>'+i+"</tr></table>";showModal(i)};n.showSwapModal=function(){for(var f,r=[],u='<table id="swaptable" title="'+t("Select the letters you want to swap")+'"><tr>',i=0;i<n.racksize;++i)(f=el(n.plrRackId+i),f.holds!=="")&&(r.push(f.firstChild),u+='<td id="swap-candidate'+i+'" class="tile" onclick="this.classList.toggle(\'to-swap\')"></td>');for(u+="</tr></table>",n.prompt(u,'<button class="button" onclick="g_bui.onSwap()">'+t("Swap")+" & "+t("Pass")+"</button>"),i=0;i<r.length;++i)n.rd.enableDrag(!1,r[i]),el("swap-candidate"+i).appendChild(r[i])};n.toggleORV=function(){n.showOpRack=1-n.showOpRack;el("toggle").innerHTML=n.showOpRack?t("Hide computer&rsquo;s rack"):t("Show computer&rsquo;s rack");for(var i=0;i<n.racksize;++i)el(n.oppRackId+i).classList.toggle("on",n.showOpRack)};n.wordInfo=function(i){var r,e,o,u,f,s;if(!window.g_defs){alert(t("Word definitions not enabled."));return}if(i in g_defs){r='<div id="wordresult"><div style="text-align:center"><h1>'+i+"</h1></div>";for(e in g_defs[i])for(r+='<div class="phanloai">'+(e||"&nbsp;")+"</div>",o=0;o<g_defs[i][e].length;++o){if(u=g_defs[i][e][o],r+='<ul class="list1"><li>'+u.definition,u.examples)for(f=0;f<u.examples.length;++f)for(s in u.examples[f])r+='<ul class="list2"><li><span class="example-original">'+s+"</span><br>"+u.examples[f][s]+"</li></ul>";r+="</li></ul>"}r+="</div>";n.prompt(r)}else getJsonp("https://m.vdict.com/mobile/dictjson?fromapp=1&word="+encodeURIComponent(i)+"&dict=2",function(){g_def=g_def.replace('href="#"','onclick="el(\'audio\').play()" title="'+t("Listen to pronunciation")+'"');g_def=g_def.replace(" Suggestions:","");g_def=g_def.replace(/">(.+?) not found/,'"><b>$1</b> '+t("not found"));n.prompt(g_def);gtag("event",i,{event_category:"Definition",event_label:g_def.indexOf("</b> not found")<0?"Found":"Not Found"})})}}function init(n){for(var e,r,u,i,s=g_letters.length,t=0;t<s;++t){var f=g_letters[t],o=f[0],h=f[1],c=f[2];for(g_letscore[o]=h,e=0;e<c;++e)g_letpool.push(o)}shufflePool();r="";u="";r=takeLetters(r);u=takeLetters(u);g_bui.create(n,g_boardwidth,g_boardheight,g_letscore,g_racksize);g_bui.setPlayerRack(r);g_bui.setOpponentRack(u);g_bui.setTilesLeft(g_letpool.length);i=[];for(t in g_wordmap)t.length>15||(i[t.length-2]||(i[t.length-2]=[]),i[t.length-2].push(t));for(t=0;t<i.length;++t)i[t]&&g_wstr.push("_"+i[t].join("_")+"_")}function announceWinner(){for(var u,i,r,f=g_bui.getOpponentRack(),e=g_bui.getPlayerRack(),o=0,n=0;n<f.length;++n)o+=g_letscore[f.charAt(n)];for(u=0,n=0;n<e.length;++n)u+=g_letscore[e.charAt(n)];g_oscore-=o;g_pscore-=u;i=t("Game over. The score is...");i+="<ul><li>";i+=t("You: ")+g_pscore+"</li><li>"+t("Computer: ")+g_oscore+"</li></ul>";r=t("It&rsquo;s a tie!");g_oscore>g_pscore?r=t("Computer wins."):g_oscore<g_pscore&&(r=t("You win!"));i+="<h3>"+r+"</h3>";g_bui.prompt(i,'<button class="button" onclick="location.reload()">'+t("Play Again")+"</button>");gtag("event","Game Over",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"Player="+g_pscore+", Computer="+g_oscore,value:g_letpool.length})}function checkValidPlacement(n){var a,it,ut,ct,l,v,y,p,w;if(n.length===0)return{played:"",msg:t("no letters were placed.")};var rt={},o="",b="",i=n[0].x,r=n[0].y,k=i,d=r,u=0,s=0,st=g_bui.getStartXY(),ht=!1,f,e,g;for(l=0;l<n.length;++l)a=n[l],b+=a.lsc===0?"*":a.ltr,f=a.x,e=a.y,f===st.x&&e===st.y&&(ht=!0),g=f+"_"+e,rt[g]=a,i>f&&(i=f),k<f&&(k=f),r>e&&(r=e),d<e&&(d=e);if(r<d&&(s=1),i<k&&(u=1),u===1&&s===1)return{played:"",msg:t("word must be horizontal or vertical.")};if(g_board_empty&&!ht)return{played:"",msg:t("first word must be on the star.")};if(it=g_board.length,ut=it,u===0&&s===0)if(i>0&&g_board[i-1][r]!==""||i<it-1&&g_board[i+1][r]!=="")u=1;else if(r>0&&g_board[i][r-1]!==""||r<ut-1&&g_board[i][r+1]!=="")s=1;else return b="<strong>"+b.toUpperCase()+"</strong>",ct=b+t(" is not connected to a word."),{played:"",msg:ct};var pt=u===1?k-i+1:d-r+1,lt=i-u,at=r-s,h="",vt=1,nt=0,ft=0,c,et=[];for(l=0;l<pt;++l){if(f=lt+u,e=at+s,c=g_board[f][e],c==="")return{played:"",msg:t("spaces in word.")};if(g=f+"_"+e,g in rt){var wt=rt[g],yt=g_boardmults[f][e],ot=wt.lsc,tt=getOrthWordScore(c,ot,f,e,u,s);ot*=g_lmults[yt];nt+=ot;vt*=g_wmults[yt];tt.score===-1&&(o!==""&&(o+=", "),o+=tt.word.toUpperCase());tt.score>0&&(ft+=tt.score,et.push(tt.word))}else nt+=g_boardpoints[f][e];h+=c;lt+=u;at+=s}for(v=i-u,y=r-s;v>=0&&y>=0&&g_board[v][y]!=="";)c=g_board[v][y],nt+=g_boardpoints[v][y],h=c+h,v-=u,y-=s;for(p=k+u,w=d+s;p<it&&w<ut&&g_board[p][w]!=="";)c=g_board[p][w],nt+=g_boardpoints[p][w],h+=c,p+=u,w+=s;return(h in g_wordmap||(o!==""&&(o+=", "),o+=h.toUpperCase()),o!=="")?(gtag("event","Word Not Found",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:o}),o="<strong>"+o+"</strong>",o+=t(" not found in dictionary."),{played:"",msg:o}):!g_board_empty&&ft===0&&h.length===n.length?{played:"",msg:t("word is not connected.")}:(et.push(h),{played:b,score:nt*vt+ft,words:et})}function findBestMove(n){for(var i,r,e=n.split(""),u=-1,f=null,t=0;t<g_board.length;++t)for(i=0;i<g_board[t].length;++i)g_board[t][i]===""&&(r=findBestWord(e,t,i),r.score>u&&(u=r.score,f=r));return f}function findBestWord(n,t,i,r){var o=-1,s={score:-1},u,h,c,e,f;r||(r=["x","y"]);for(h in r){switch(g_playlevel){case 0:u=randFloat(50,100,16);break;case 1:u=randFloat(55,100,16);break;case 2:u=randFloat(60,100,16);break;case 3:u=randFloat(65,100,16);break;case 4:u=randFloat(70,100,16);break;case 5:u=randFloat(75,100,16);break;case 6:u=randFloat(80,100,16);break;case 7:u=randFloat(85,100,16);break;case 8:u=randFloat(90,100,16);break;case 9:u=randFloat(95,100,16)}Math.random()>u/100||(c=r[h],e=getRegex(c,t,i,n.join("")),e!==null&&(f=getBestScore(e,n,t,i),f.score>o&&(o=f.score,s=f)))}return s}function findFirstMove(n,t){for(var u,o,e,f,i={score:-1},r={score:-1},h=function(){for(var o=0,n;o<t+1;++o)n=o,g_board[n][t]=e,g_boardpoints[n][t]=f,r=findBestWord(u,n+1,t,["x"]),r.score>i.score&&r.ps+r.word.length>t&&(i=r,i.aletscr=f),g_board[n][t]="",g_boardpoints[n][t]=0},c=function(){for(var o=0,n;o<t+1;++o)n=o,g_board[t][n]=e,g_boardpoints[t][n]=f,r=findBestWord(u,t,n+1,["y"]),r.score>i.score&&r.ps+r.word.length>t&&(i=r,i.aletscr=f),g_board[t][n]="",g_boardpoints[t][n]=0},s=0;s<n.length;++s)u=n.split(""),o=s,e=u[o],f=g_letscore[e],u.splice(o,1),Math.random()<.5?(h(),c()):(c(),h());return i.score===-1?null:(i[i.xy==="x"?"ax":"ay"]=i.ps,i.lscrs.unshift(i.aletscr),i.prec="",i.seq=i.word,i)}function getBestScore(n,t,i,r){for(var s,d,h,tt,c,e,o,p,l,w,g,a,b,k,f,v,y={},nt=0,u=0;u<t.length;++u)s=t[u],s==="*"?++nt:s in y?++y[s]:y[s]=1;if(d=-1,h={score:-1},n.max-1>=g_wstr.length)return h;for(tt=new RegExp(n.rgx,"g"),l=n.min-2;l<n.max-1;++l){if(w=n.rgx+l,w in g_matches_cache)e=g_matches_cache[w];else{for(e=[];(c=tt.exec(g_wstr[l]))!==null;){for(o="",u=1;u<c.length;++u)c[u]&&(o+=c[u]);g=c[0];p=g.substr(1,g.length-2);e.push({word:p,reqs:o})}g_matches_cache[w]=e}for(a=0;a<e.length;++a){b=[];o=e[a].reqs;p=e[a].word;var it=gCloneFunc(y),rt=!0,ut=nt;for(u=0;u<o.length;++u)if(k=o.charAt(u),it[k]>0)--it[k],b.push(g_letscore[k]);else{if(ut===0){rt=!1;break}--ut;b.push(0)}rt&&(f={word:p,ax:i,ay:r},f.seq=o,f.lscrs=b,f.ps=n.ps,f.xy=n.xy,f.prec=n.prec,v=getWordScore(f),v<=g_maxwpoints[g_playlevel]&&d<v&&(d=v,h=f,h.score=v))}}return h}function getOrthWordScore(n,t,i,r,u,f){var c=1,h=0,e=i,o=r,v=g_board.length,y=g_board[i].length,p=g_board[e][o],w=g_boardpoints[e][o],l=g_boardmults[e][o],s,a;for(c*=g_wmults[l],t*=g_lmults[l],g_board[e][o]=n,g_boardpoints[e][o]=t;i>=0&&r>=0&&g_board[i][r]!=="";)i-=f,r-=u;for((i<0||r<0||g_board[i][r]==="")&&(i+=f,r+=u),s="";i<v&&r<y&&g_board[i][r]!=="";)a=g_board[i][r],h+=g_boardpoints[i][r],s+=a,i+=f,r+=u;return(g_board[e][o]=p,g_boardpoints[e][o]=w,s.length===1)?{score:0,word:s}:(s in g_wordmap)?(h*=c,{score:h,word:s}):{score:-1,word:s}}function getRegex(n,t,i,r){var st="["+r+"]",ht,yt,pt,h,p,bt,kt;if(g_opponent_has_joker&&(st=g_letrange),ht=r.length,g_board[t][i]!=="")return null;var ct=n==="x",e=ct?t:i,c=ct?g_board.length:g_board[t].length,o=ct?1:0,s=1-o,b=!1,tt=t-o,it=i-s;e>0&&g_board[tt][it]!==""&&(b=!0);var lt=e,rt=t+o,ut=i+s,at=c,vt;for(b||(vt=0);lt<c-1;){if(g_board[rt][ut]!==""){b=!0;break}else++vt;if(vt>ht)break;if(it=ut-o,tt=rt-s,yt=ut+o,pt=rt+s,tt>=0&&it>=0&&g_board[tt][it]!==""||pt<c&&yt<c&&g_board[pt][yt]!==""){at=lt+1;b=!0;break}rt+=o;ut+=s;++lt}if(!b)return null;for(var k=e-1,v=t-o,y=i-s;k>=0&&g_board[v][y]!=="";)v-=o,y-=s,--k;for(k<0&&(k=0,v<0?v=0:y<0&&(y=0)),h="",p=k;p<e;++p)h+=g_board[v][y],v+=o,y+=s;for(var d=t,g=i,l=e,dt="_",u="_"+h,ft="",gt=0,f=0,a=0,wt=1,nt,et=h.length,ot=e,w;l<c;){if(w=g_board[d][g],w===""){if(l===e&&et>0?(a=et+1,nt=!0):nt=!1,++f,gt===ht)break;++gt}else f>0&&(u+="("+st,f>1&&(h!==""&&(ft="|"+u,f>2&&(ft+="{1,"+(f-1)+"}"),ft+=")"+dt),u+="{"+f+"}"),u+=")",a===0&&(a=et+f,nt=!0),nt&&ot===e&&(ot=l),f=0),u+=w,nt&&++a,wt=0;d+=o;g+=s;++l}if(f>0){if(u+="("+st,l===c)u+="{"+wt+","+f+"}";else if(g_board[d][g]==="")u+="{"+wt+","+f+"}";else for(u+="{"+f+"}",p=l+1;p<c;++p){if(w=g_board[d][g],w==="")break;u+=w;d+=o;g+=s}u+=")"}return ot===e?a=h!==""?et+1:at-e+1:(bt=ot-at,bt>1&&(a-=bt)),kt=e-h.length,u+=dt+ft,{min:a,max:l-kt,prec:h,ps:kt,rgx:u,xy:n}}function getWordScore(n){var s=n.xy==="x",c=n.ax,k=n.ay,d=s?g_board.length:g_board[c].length,h=s?1:0,l=1-h,f=n.ps,a=n.seq,v=0,t,i;s?(t=f,i=k):(t=c,i=f);for(var y=[],r=0,p=0,g=0,nt=n.lscrs,w=1,e,o,b,u;f<d;){if(e=g_boardmults[t][i],w*=g_wmults[e],g_board[t][i]===""){if(o=nt[v],b=a.charAt(v++),u=getOrthWordScore(b,o,t,i,h,l),u.score===-1)return-1;u.score>0&&y.push(u.word);o*=g_lmults[e];r+=o;p+=u.score}else r+=g_boardpoints[t][i]*g_lmults[e];if(t+=h,i+=l,++f,++g===n.word.length)break}return r*=w,a.length===g_racksize&&(r+=g_allLettersBonus),n.owords=y,r+p}function onPlayerClear(){g_bui.cancelPlayerPlacement()}function onPlayerMove(){var o=self.passed,f,r,u,n,s,h;if(o&&(++g_passes,g_passes>=g_maxpasses)){announceWinner();return}if(f=g_bui.getBoard(),g_board=f.board,g_boardpoints=f.boardp,o)g_bui.cancelPlayerPlacement();else{var c=g_bui.getPlayerPlacement(),i=checkValidPlacement(c),e=i.played;if(e===""){g_bui.prompt(t("Sorry, ")+i.msg);return}if(g_bui.acceptPlayerPlacement(),g_board_empty=!1,g_passes=0,e.length===g_racksize&&(g_pscore+=g_allLettersBonus),g_pscore+=i.score,g_bui.setPlayerScore(i.score,g_pscore),g_bui.addToHistory(i.words,1),g_bui.removeFromPlayerRack(e),r=g_bui.getPlayerRack(),r=takeLetters(r),r===""){announceWinner();return}g_bui.setPlayerRack(r);g_bui.setTilesLeft(g_letpool.length)}if(u=g_bui.getOpponentRack(),g_opponent_has_joker=u.search("\\*")!==-1,g_playlevel=g_bui.getPlayLevel(),g_board_empty?(s=g_bui.getStartXY(),n=findFirstMove(u,s.y)):n=findBestMove(u),h=function(){var i,r,f,e,t,o,h,s;for(g_bui.makeTilesFixed(),i=n.owords,i.push(n.word),g_bui.addToHistory(i,2),r=n.score,g_oscore+=r,n.seq.length===g_racksize&&(g_oscore+=g_allLettersBonus),g_bui.setOpponentScore(r,g_oscore),f=n.seq,e="",t=0;t<f.length;++t)o=f.charAt(t),e+=u.search(o)>-1?o:"*";if(g_bui.removeFromOpponenentRack(e),h=g_bui.getOpponentRack(),s=takeLetters(h),s===""){announceWinner();return}g_bui.setOpponentRack(s);g_bui.setTilesLeft(g_letpool.length);el("pass").disabled=!1},n!==null)placeOnBoard(n,h),g_passes=0;else{gtag("event","Computer Pass",{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"["+g_bui.getOpponentRack()+"]",value:g_letpool.length});++g_passes;g_passes>=g_maxpasses?announceWinner():(g_bui.prompt(t("I pass, your turn.")),g_bui.makeTilesFixed());return}}function onPlayerMoved(n,t){n&&(el("pass").disabled=!0,g_bui.cancelPlayerPlacement(),g_bui.showBusy());self.passed=n;clearTimeout(g_bui.timer);setTimeout(onPlayerMove,100);gtag("event","Player "+(t?"Swap":"Pass"),{event_category:"Gameplay - Lvl "+(g_playlevel+1),event_label:"["+g_bui.getPlayerRack()+"]",value:g_letpool.length})}function onPlayerSwap(){var n=g_letpool.length;if(n===0){g_bui.prompt(t("Sorry, no tiles left to swap."));return}g_bui.cancelPlayerPlacement();g_bui.showSwapModal(n)}function onPlayerSwapped(n,t){if(t.length===0){g_bui.setPlayerRack(n);g_bui.makeTilesFixed();return}for(var i=0;i<t.length;++i)g_letpool.push(t.charAt(i));shufflePool();g_bui.setPlayerRack(takeLetters(n));onPlayerMoved(!0,!0)}function placeOnBoard(n,t){var u=0,c=n.seq.length,o=1,s=0;n.xy==="y"&&(o=0,s=1);for(var i=n.ax,r=n.ay,h=[],f,e;u<c;)g_board[i][r]===""&&(f=n.seq.charAt(u),e=n.lscrs[u++],h.push({x:i,y:r,ltr:f,lscr:e}),g_board[i][r]=f,g_boardpoints[i][r]=e),i+=o,r+=s;hideModal();g_bui.playOpponentMove(h,t);g_board_empty=!1}function shufflePool(){for(var t,r,i=g_letpool.length,n=0;n<i;++n)t=Math.floor(Math.random()*i),r=g_letpool[n],g_letpool[n]=g_letpool[t],g_letpool[t]=r}function takeLetters(n){var i=g_letpool.length,t,r;return i===0?n:(t=g_racksize-n.length,t>i&&(t=i),r=g_letpool.slice(0,t).join(""),g_letpool.splice(0,t),r+n)}function closeModal(){if(el("swaptable"))g_bui.onSwap(!0);else{var n=g_cache.modalContent.querySelector(".button");n?n.click():hideModal()}}function handleHideModal(n){n.target&&n.target.id==="modal-inner"&&closeModal()}function handleKeyDown(n){n.key==="Escape"&&closeModal()}var REDIPS=REDIPS||{},g_boardm,g_bui;REDIPS.drag=function(){var or,ht,wt,sr,wi,bi,hr,cr,bt,kt,dt,ki,di,ct,ri,gi,ot,gt,at,nr,tt,p,et,ui,fi,ei,tr,oi,ir,rt,b,rr,lr,ni,ti,si,ar,vr,yr,pr,ur,hi,ci,li,wr,ii,fr,br,ai,kr,l=null,h={width:0,height:0},e={width:null,height:null,container:[],obj:null},r={page:{x:0,y:0},div:{x:0,y:0},flag:{x:0,y:0}},vt,n=[],yt,vi,a,lt=[],s=[],k=null,it=null,nt={x:0,y:0},ut={x:0,y:0,value:7,flag:!1},er=!1,pt=!1,yi=[],i=null,y=null,d=null,u=null,w=null,ft=null,o=null,g=null,st=null,t=!1,c=!1,v="cell",pi={div:[],cname:"only",other:"deny"},dr={action:"deny",cname:"mark",exception:[]},f={},gr={keyDiv:!1,keyRow:!1,sendBack:!1,drop:!1},nu={changed:function(){},clicked:function(){},cloned:function(){},clonedDropped:function(){},clonedEnd1:function(){},clonedEnd2:function(){},dblClicked:function(){},deleted:function(){},dropped:function(){},droppedBefore:function(){},finish:function(){},moved:function(){},notCloned:function(){},notMoved:function(){},shiftOverflow:function(){},relocateBefore:function(){},relocateAfter:function(){},relocateEnd:function(){},rowChanged:function(){},rowClicked:function(){},rowCloned:function(){},rowDeleted:function(){},rowDropped:function(){},rowDroppedBefore:function(){},rowDroppedSource:function(){},rowMoved:function(){},rowNotCloned:function(){},rowNotMoved:function(){},rowUndeleted:function(){},switched:function(){},undeleted:function(){}};return or=function(n){var u=this,i,r,t;for((n===undefined||typeof n!="string")&&(n="drag"),k=document.getElementById(n),document.getElementById("redips_clone")||(r=document.createElement("div"),r.id="redips_clone",k.appendChild(r)),wt("init"),ht(),gi(),REDIPS.event.add(window,"resize",gi),i=k.getElementsByTagName("img"),t=0;t<i.length;++t)REDIPS.event.add(i[t],"mousemove",wi),REDIPS.event.add(i[t],"touchmove",wi);REDIPS.event.add(window,"scroll",p)},wi=function(){return!1},ht=function(t){var u,h,f,e,c,s,l,r,o,i;for(n.length=0,f=t===undefined?k.getElementsByTagName("table"):document.querySelectorAll(t),r=0,i=0;r<f.length;++r)if(f[r].parentNode.id!=="redips_clone"&&!(f[r].className.indexOf("nolayout")>-1)){u=f[r].parentNode;h=0;do u.nodeName==="TD"&&++h,u=u.parentNode;while(u&&u!==k);for(n[i]=f[r],n[i].redips||(n[i].redips={}),n[i].redips.container=k,n[i].redips.nestedLevel=h,n[i].redips.idx=i,yi[i]=0,c=n[i].getElementsByTagName("td"),s=0,l=!1;s<c.length;++s)if(c[s].rowSpan>1){l=!0;break}n[i].redips.rowspan=l;++i}for(r=0,o=yt=1;r<n.length;++r)if(n[r].redips.nestedLevel===0){for(n[r].redips.nestedGroup=o,n[r].redips.sort=yt*100,e=n[r].getElementsByTagName("table"),i=0;i<e.length;++i)e[i].className.indexOf("nolayout")>-1||(e[i].redips.nestedGroup=o,e[i].redips.sort=yt*100+e[i].redips.nestedLevel);++o;++yt}},bi=function(r){var e=r||window.event,s,ct,et,h,it;if(this.redips.animated===!0||(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),er=e.shiftKey,ct=e.which?e.which:e.button,ir(e)||!e.touches&&ct!==1))return!0;if(window.getSelection)window.getSelection().removeAllRanges();else if(document.selection&&document.selection.type==="Text")try{document.selection.empty()}catch(lt){}return(e.touches?(h=nt.x=e.touches[0].clientX,it=nt.y=e.touches[0].clientY):(h=nt.x=e.clientX,it=nt.y=e.clientY),ut.x=h,ut.y=it,ut.flag=!1,REDIPS.drag.objOld=c=t||this,REDIPS.drag.obj=t=this,pt=t.className.indexOf("clone")>-1?!0:!1,REDIPS.drag.tableSort&&cr(t),k!==t.redips.container&&(k=t.redips.container,ht()),t.className.indexOf("row")===-1?REDIPS.drag.mode=v="cell":(REDIPS.drag.mode=v="row",REDIPS.drag.obj=t=ii(t)),p(),pt||v!=="cell"||(t.style.zIndex=999),i=u=o=null,ot(),d=y=i,ft=w=u,st=g=o,REDIPS.drag.td.source=f.source=b("TD",t),REDIPS.drag.td.current=f.current=f.source,REDIPS.drag.td.previous=f.previous=f.source,v==="cell"?REDIPS.drag.event.clicked(f.current):REDIPS.drag.event.rowClicked(f.current),(i===null||u===null||o===null)&&(ot(),d=y=i,ft=w=u,st=g=o,i===null||u===null||o===null))?!0:(vi=a=!1,REDIPS.event.add(document,"mousemove",kt),REDIPS.event.add(document,"touchmove",kt),REDIPS.event.add(document,"mouseup",bt),REDIPS.event.add(document,"touchend",bt),t.setCapture&&t.setCapture(),i!==null&&u!==null&&o!==null&&(vt=nr(i,u,o)),et=rt(n[d],"position"),et!=="fixed"&&(et=rt(n[d].parentNode,"position")),s=tt(t,et),l=[it-s[0],s[1]-h,s[2]-it,h-s[3]],k.onselectstart=function(n){return e=n||window.event,ir(e)?void 0:(e.shiftKey&&document.selection.clear(),!1)},!1)},hr=function(){REDIPS.drag.event.dblClicked()},cr=function(t){var r,u,i;for(r=b("TABLE",t),u=r.redips.nestedGroup,i=0;i<n.length;++i)n[i].redips.nestedGroup===u&&(n[i].redips.sort=yt*100+n[i].redips.nestedLevel);n.sort(function(n,t){return t.redips.sort-n.redips.sort});++yt},ii=function(n,t){var i,e,r,h,o,c,u,f,s;if(n.nodeName==="DIV")return u=n,n=b("TR",n),n.redips===undefined&&(n.redips={}),n.redips.div=u,n;for(r=n,r.redips===undefined&&(r.redips={}),n=b("TABLE",n),pt&&a&&(u=r.redips.div,u.className=ai(u.className.replace("clone",""))),i=n.cloneNode(!0),pt&&a&&(u.className=u.className+" clone"),h=i.rows.length-1,o=t==="animated"?h===0?!0:!1:!0,f=h;f>=0;--f)if(f!==r.rowIndex){if(o===!0&&t===undefined)for(c=i.rows[f],s=0;s<c.cells.length;++s)if(c.cells[s].className.indexOf("rowhandler")>-1){o=!1;break}i.deleteRow(f)}return a||(r.redips.emptyRow=o),i.redips={},i.redips.container=n.redips.container,i.redips.sourceRow=r,br(r,i.rows[0]),tr(r,i.rows[0]),document.getElementById("redips_clone").appendChild(i),e=tt(r,"fixed"),i.style.position="fixed",i.style.top=e[0]+"px",i.style.left=e[3]+"px",i.style.width=e[1]-e[3]+"px",i},fr=function(r,u,e){var v=!1,y,h,s={},o={},l;l=function(n){var t;n.redips!==undefined&&n.redips.emptyRow?li(n,"empty",REDIPS.drag.style.rowEmptyColor):(t=b("TABLE",n),t.deleteRow(n.rowIndex))};e===undefined?e=t:v=!0;s.row=e.redips.sourceRow;s.rowIndex=s.row.rowIndex;s.table=b("TABLE",s.row);s.tableSection=s.table.rows[0].parentNode;o.table=n[r];o.row=o.table.rows[u];o.rowIndex=u;o.tableSection=o.table.rows[0].parentNode;h=e.getElementsByTagName("tr")[0];e.parentNode.removeChild(e);y=REDIPS.drag.event.rowDroppedBefore(s.table,s.rowIndex);y!==!1&&(!v&&f.target.className.indexOf(REDIPS.drag.trash.className)>-1?a?REDIPS.drag.event.rowDeleted():REDIPS.drag.trash.questionRow?confirm(REDIPS.drag.trash.questionRow)?(l(s.row),REDIPS.drag.event.rowDeleted()):(delete c.redips.emptyRow,REDIPS.drag.event.rowUndeleted()):(l(s.row),REDIPS.drag.event.rowDeleted()):(o.rowIndex<o.table.rows.length?i===d?s.rowIndex>o.rowIndex?o.tableSection.insertBefore(h,o.row):o.tableSection.insertBefore(h,o.row.nextSibling):REDIPS.drag.rowDropMode==="after"?o.tableSection.insertBefore(h,o.row.nextSibling):o.tableSection.insertBefore(h,o.row):(o.tableSection.appendChild(h),o.row=o.table.rows[0]),o.row&&o.row.redips&&o.row.redips.emptyRow?o.tableSection.deleteRow(o.row.rowIndex):REDIPS.drag.rowDropMode==="overwrite"?l(o.row):REDIPS.drag.rowDropMode!=="switch"||a||(s.tableSection.insertBefore(o.row,s.row),s.row.redips!==undefined&&delete s.row.redips.emptyRow),(v||!a)&&l(s.row),delete h.redips.emptyRow,v||REDIPS.drag.event.rowDropped(h,s.table,s.rowIndex)),h.getElementsByTagName("table").length>0&&ht())},br=function(n,t){var o,u=[],f=[],i,r,e;for(u[0]=n.getElementsByTagName("input"),u[1]=n.getElementsByTagName("textarea"),u[2]=n.getElementsByTagName("select"),f[0]=t.getElementsByTagName("input"),f[1]=t.getElementsByTagName("textarea"),f[2]=t.getElementsByTagName("select"),i=0;i<u.length;++i)for(r=0;r<u[i].length;++r){o=u[i][r].type;switch(o){case"text":case"textarea":case"password":f[i][r].value=u[i][r].value;break;case"radio":case"checkbox":f[i][r].checked=u[i][r].checked;break;case"select-one":f[i][r].selectedIndex=u[i][r].selectedIndex;break;case"select-multiple":for(e=0;e<u[i][r].options.length;++e)f[i][r].options[e].selected=u[i][r].options[e].selected}}},bt=function(s){var pt=s||window.event,h,nt,tt,it,et,ot,b,rt,yt,l;if(et=pt.clientX,ot=pt.clientY,r.flag.x=r.flag.y=0,t.releaseCapture&&t.releaseCapture(),REDIPS.event.remove(document,"mousemove",kt),REDIPS.event.remove(document,"touchmove",kt),REDIPS.event.remove(document,"mouseup",bt),REDIPS.event.remove(document,"touchend",bt),k.onselectstart=null,di(t),e.width=document.documentElement.scrollWidth,e.height=document.documentElement.scrollHeight,r.flag.x=r.flag.y=0,a&&v==="cell"&&(i===null||u===null||o===null))t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(i===null||u===null||o===null)REDIPS.drag.event.notMoved();else{if(i<n.length?(h=n[i],REDIPS.drag.td.target=f.target=h.rows[u].cells[o],at(i,u,o,vt),nt=i,tt=u):y===null||w===null||g===null?(h=n[d],REDIPS.drag.td.target=f.target=h.rows[ft].cells[st],at(d,ft,st,vt),nt=d,tt=ft):(h=n[y],REDIPS.drag.td.target=f.target=h.rows[w].cells[g],at(y,w,g,vt),nt=y,tt=w),v==="row")if(vi)if(d===nt&&ft===tt){for(it=t.getElementsByTagName("tr")[0],c.style.backgroundColor=it.style.backgroundColor,l=0;l<it.cells.length;++l)c.cells[l].style.backgroundColor=it.cells[l].style.backgroundColor;t.parentNode.removeChild(t);delete c.redips.emptyRow;a?REDIPS.drag.event.rowNotCloned():REDIPS.drag.event.rowDroppedSource(f.target)}else fr(nt,tt);else REDIPS.drag.event.rowNotMoved();else if(a||ut.flag)if(a&&d===i&&ft===u&&st===o)t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(a&&REDIPS.drag.clone.drop===!1&&(et<h.redips.offset[3]||et>h.redips.offset[1]||ot<h.redips.offset[0]||ot>h.redips.offset[2]))t.parentNode.removeChild(t),lt[c.id]-=1,REDIPS.drag.event.notCloned();else if(f.target.className.indexOf(REDIPS.drag.trash.className)>-1)t.parentNode.removeChild(t),REDIPS.drag.trash.question?setTimeout(function(){confirm(REDIPS.drag.trash.question)?ki():(a||(n[d].rows[ft].cells[st].appendChild(t),p()),REDIPS.drag.event.undeleted())},20):ki();else if(REDIPS.drag.dropMode==="switch")if(b=REDIPS.drag.event.droppedBefore(f.target),b===!1)dt(!1);else{for(t.parentNode.removeChild(t),rt=f.target.getElementsByTagName("div"),yt=rt.length,l=0;l<yt;++l)rt[0]!==undefined&&(REDIPS.drag.objOld=c=rt[0],f.source.appendChild(c),ct(c));dt();yt&&REDIPS.drag.event.switched()}else REDIPS.drag.dropMode==="overwrite"?(b=REDIPS.drag.event.droppedBefore(f.target),b!==!1&&ti(f.target),dt(b)):(b=REDIPS.drag.event.droppedBefore(f.target),dt(b));else REDIPS.drag.event.notMoved();v==="cell"&&t.getElementsByTagName("table").length>0&&ht();p();REDIPS.drag.event.finish()}y=w=g=null},dt=function(n){var u=null,r,i;if(n!==!1){if(gr.sendBack===!0){for(r=f.target.getElementsByTagName("DIV"),i=0;i<r.length;++i)if(t!==r[i]&&t.id.indexOf(r[i].id)===0){u=r[i];break}if(u){oi(u,1);t.parentNode.removeChild(t);return}}REDIPS.drag.dropMode==="shift"&&(kr(f.target)||REDIPS.drag.shift.after==="always")&&si(f.source,f.target);REDIPS.drag.multipleDrop==="top"&&f.target.hasChildNodes()?f.target.insertBefore(t,f.target.firstChild):f.target.appendChild(t);ct(t);REDIPS.drag.event.dropped(f.target);a&&(REDIPS.drag.event.clonedDropped(f.target),oi(c,-1))}else a&&t.parentNode&&t.parentNode.removeChild(t)},ct=function(n,t){t===!1?(n.onmousedown=null,n.ontouchstart=null,n.ondblclick=null):(n.onmousedown=bi,n.ontouchstart=bi,n.ondblclick=hr)},di=function(n){n.style.position="";n.style.zIndex="";n.style.top="";n.style.left="";n.style.width="";n.style.height=""},ki=function(){var n;if(a&&oi(c,-1),REDIPS.drag.dropMode==="shift"&&(REDIPS.drag.shift.after==="delete"||REDIPS.drag.shift.after==="always")){switch(REDIPS.drag.shift.mode){case"vertical2":n="lastInColumn";break;case"horizontal2":n="lastInRow";break;default:n="last"}si(f.source,rr(n,f.source)[2])}REDIPS.drag.event.deleted(a)},kt=function(n){var y=n||window.event,o=REDIPS.drag.scroll.bound,f,i,u,k,d,w,b;if(y.touches?(i=nt.x=y.touches[0].clientX,u=nt.y=y.touches[0].clientY):(i=nt.x=y.clientX,u=nt.y=y.clientY),k=Math.abs(ut.x-i),d=Math.abs(ut.y-u),vi||(v==="cell"&&(pt||REDIPS.drag.clone.keyDiv===!0&&er)?(REDIPS.drag.objOld=c=t,REDIPS.drag.obj=t=ei(t,!0),a=!0,REDIPS.drag.event.cloned(),gt()):(v==="row"&&((pt||REDIPS.drag.clone.keyRow===!0&&er)&&(a=!0),REDIPS.drag.objOld=c=t,REDIPS.drag.obj=t=ii(t),t.style.zIndex=999),t.setCapture&&t.setCapture(),t.style.width=t.offsetWidth+"px",t.style.height=t.offsetHeight+"px",t.style.position="fixed",p(),ot(),v==="row"&&(a?REDIPS.drag.event.rowCloned():REDIPS.drag.event.rowMoved()),gt()),i>h.width-l[1]&&(t.style.left=h.width-(l[1]+l[3])+"px"),u>h.height-l[2]&&(t.style.top=h.height-(l[0]+l[2])+"px")),vi=!0,v==="cell"&&(k>ut.value||d>ut.value)&&!ut.flag&&(ut.flag=!0,gt(),REDIPS.drag.event.moved(a)),i>l[3]&&i<h.width-l[1]&&(t.style.left=i-l[3]+"px"),u>l[0]&&u<h.height-l[2]&&(t.style.top=u-l[0]+"px"),i<it[1]&&i>it[3]&&u<it[2]&&u>it[0]&&r.flag.x===0&&r.flag.y===0&&(s.containTable||i<s[3]||i>s[1]||u<s[0]||u>s[2])&&(ot(),ri()),REDIPS.drag.scroll.enable)for(r.page.x=o-(h.width/2>i?i-l[3]:h.width-i-l[1]),r.page.x>0?(r.page.x>o&&(r.page.x=o),w=et()[0],r.page.x*=i<h.width/2?-1:1,r.page.x<0&&w<=0||r.page.x>0&&w>=e.width-h.width||r.flag.x++==0&&(REDIPS.event.remove(window,"scroll",p),ui(window))):r.page.x=0,r.page.y=o-(h.height/2>u?u-l[0]:h.height-u-l[2]),r.page.y>0?(r.page.y>o&&(r.page.y=o),w=et()[1],r.page.y*=u<h.height/2?-1:1,r.page.y<0&&w<=0||r.page.y>0&&w>=e.height-h.height||r.flag.y++==0&&(REDIPS.event.remove(window,"scroll",p),fi(window))):r.page.y=0,b=0;b<e.container.length;++b)if(f=e.container[b],f.autoscroll&&i<f.offset[1]&&i>f.offset[3]&&u<f.offset[2]&&u>f.offset[0]){r.div.x=o-(f.midstX>i?i-l[3]-f.offset[3]:f.offset[1]-i-l[1]);r.div.x>0?(r.div.x>o&&(r.div.x=o),r.div.x*=i<f.midstX?-1:1,r.flag.x++==0&&(REDIPS.event.remove(f.div,"scroll",p),ui(f.div))):r.div.x=0;r.div.y=o-(f.midstY>u?u-l[0]-f.offset[0]:f.offset[2]-u-l[2]);r.div.y>0?(r.div.y>o&&(r.div.y=o),r.div.y*=u<f.midstY?-1:1,r.flag.y++==0&&(REDIPS.event.remove(f.div,"scroll",p),fi(f.div))):r.div.y=0;break}else r.div.x=r.div.y=0;y.cancelBubble=!0;y.stopPropagation&&y.stopPropagation()},ri=function(){i<n.length&&(i!==y||u!==w||o!==g)&&(y!==null&&w!==null&&g!==null&&(at(y,w,g,vt),REDIPS.drag.td.previous=f.previous=n[y].rows[w].cells[g],REDIPS.drag.td.current=f.current=n[i].rows[u].cells[o],REDIPS.drag.dropMode==="switching"&&v==="cell"&&(ni(f.current,f.previous),p(),ot()),v==="cell"?REDIPS.drag.event.changed(f.current):v==="row"&&(i!==y||u!==w)&&REDIPS.drag.event.rowChanged(f.current)),gt())},gi=function(){typeof innerWidth=="number"?(h.width=window.innerWidth,h.height=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(h.width=document.documentElement.clientWidth,h.height=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(h.width=document.body.clientWidth,h.height=document.body.clientHeight);e.width=document.documentElement.scrollWidth;e.height=document.documentElement.scrollHeight;p()},ot=function(){var c,f,e,k,tt,p,b,it,rt,r=[],a,l,h;for(c=function(){y!==null&&w!==null&&g!==null&&(i=y,u=w,o=g)},a=nt.x,l=nt.y,i=0;i<n.length;++i)if(n[i].redips.enabled!==!1&&(r[0]=n[i].redips.offset[0],r[1]=n[i].redips.offset[1],r[2]=n[i].redips.offset[2],r[3]=n[i].redips.offset[3],n[i].sca!==undefined&&(r[0]=r[0]>n[i].sca.offset[0]?r[0]:n[i].sca.offset[0],r[1]=r[1]<n[i].sca.offset[1]?r[1]:n[i].sca.offset[1],r[2]=r[2]<n[i].sca.offset[2]?r[2]:n[i].sca.offset[2],r[3]=r[3]>n[i].sca.offset[3]?r[3]:n[i].sca.offset[3]),r[3]<a&&a<r[1]&&r[0]<l&&l<r[2])){for(e=n[i].redips.row_offset,u=0;u<e.length-1;++u)if(e[u]!==undefined){if(s[0]=e[u][0],e[u+1]!==undefined)s[2]=e[u+1][0];else for(h=u+2;h<e.length;++h)if(e[h]!==undefined){s[2]=e[h][0];break}if(l<=s[2])break}k=u;u===e.length-1&&(s[0]=e[u][0],s[2]=n[i].redips.offset[2]);do for(tt=n[i].rows[u].cells.length-1,o=tt;o>=0;--o)if(s[3]=e[u][3]+n[i].rows[u].cells[o].offsetLeft,s[1]=s[3]+n[i].rows[u].cells[o].offsetWidth,s[3]<=a&&a<=s[1])break;while(n[i].redips.rowspan&&o===-1&&u-->0);if(u<0||o<0?c():u!==k&&(s[0]=e[u][0],s[2]=s[0]+n[i].rows[u].cells[o].offsetHeight,(l<s[0]||l>s[2])&&c()),f=n[i].rows[u].cells[o],s.containTable=f.childNodes.length>0&&f.getElementsByTagName("table").length>0?!0:!1,f.className.indexOf(REDIPS.drag.trash.className)===-1)if(it=f.className.indexOf(REDIPS.drag.only.cname)>-1?!0:!1,it===!0){if(f.className.indexOf(pi.div[t.id])===-1){c();break}}else if(pi.div[t.id]!==undefined&&pi.other==="deny"){c();break}else if(b=f.className.indexOf(REDIPS.drag.mark.cname)>-1?!0:!1,(b===!0&&REDIPS.drag.mark.action==="deny"||b===!1&&REDIPS.drag.mark.action==="allow")&&f.className.indexOf(dr.exception[t.id])===-1){c();break}if(rt=f.className.indexOf("single")>-1?!0:!1,v==="cell"){if((REDIPS.drag.dropMode==="single"||rt)&&f.childNodes.length>0){if(f.childNodes.length===1&&f.firstChild.nodeType===3)break;for(p=!0,h=f.childNodes.length-1;h>=0;--h)if(f.childNodes[h].className&&f.childNodes[h].className.indexOf("drag")>-1){p=!1;break}if(!p&&y!==null&&w!==null&&g!==null&&(d!==i||ft!==u||st!==o)){c();break}}if(f.className.indexOf("rowhandler")>-1){c();break}if(f.parentNode.redips&&f.parentNode.redips.emptyRow){c();break}}break}},gt=function(){i<n.length&&i!==null&&u!==null&&o!==null&&(vt=nr(i,u,o),at(i,u,o),y=i,w=u,g=o)},at=function(t,r,f,e){var h,o,s;if(v==="cell"&&ut.flag)o=n[t].rows[r].cells[f].style,o.backgroundColor=e===undefined?REDIPS.drag.hover.colorTd:e.color[0].toString(),REDIPS.drag.hover.borderTd!==undefined&&(e===undefined?o.border=REDIPS.drag.hover.borderTd:(o.borderTopWidth=e.top[0][0],o.borderTopStyle=e.top[0][1],o.borderTopColor=e.top[0][2],o.borderRightWidth=e.right[0][0],o.borderRightStyle=e.right[0][1],o.borderRightColor=e.right[0][2],o.borderBottomWidth=e.bottom[0][0],o.borderBottomStyle=e.bottom[0][1],o.borderBottomColor=e.bottom[0][2],o.borderLeftWidth=e.left[0][0],o.borderLeftStyle=e.left[0][1],o.borderLeftColor=e.left[0][2]));else if(v==="row")for(h=n[t].rows[r],s=0;s<h.cells.length;++s)o=h.cells[s].style,o.backgroundColor=e===undefined?REDIPS.drag.hover.colorTr:e.color[s].toString(),REDIPS.drag.hover.borderTr!==undefined&&(e===undefined?i===d?u<ft?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:REDIPS.drag.rowDropMode==="before"?o.borderTop=REDIPS.drag.hover.borderTr:o.borderBottom=REDIPS.drag.hover.borderTr:(o.borderTopWidth=e.top[s][0],o.borderTopStyle=e.top[s][1],o.borderTopColor=e.top[s][2],o.borderBottomWidth=e.bottom[s][0],o.borderBottomStyle=e.bottom[s][1],o.borderBottomColor=e.bottom[s][2]))},nr=function(t,i,r){var s,u,f={color:[],top:[],right:[],bottom:[],left:[]},o=function(n,t){var i="border"+t+"Width",r="border"+t+"Style",u="border"+t+"Color";return[rt(n,i),rt(n,r),rt(n,u)]},e;if(v==="cell")u=n[t].rows[i].cells[r],f.color[0]=u.style.backgroundColor,REDIPS.drag.hover.borderTd!==undefined&&(f.top[0]=o(u,"Top"),f.right[0]=o(u,"Right"),f.bottom[0]=o(u,"Bottom"),f.left[0]=o(u,"Left"));else for(s=n[t].rows[i],e=0;e<s.cells.length;++e)u=s.cells[e],f.color[e]=u.style.backgroundColor,REDIPS.drag.hover.borderTr!==undefined&&(f.top[e]=o(u,"Top"),f.bottom[e]=o(u,"Bottom"));return f},tt=function(n,t,i){var f,r=0,u=0,e=n;if(t!=="fixed"&&(f=et(),r=0-f[0],u=0-f[1]),i===undefined||i===!0){do r+=n.offsetLeft-n.scrollLeft,u+=n.offsetTop-n.scrollTop,n=n.offsetParent;while(n&&n.nodeName!=="BODY")}else do r+=n.offsetLeft,u+=n.offsetTop,n=n.offsetParent;while(n&&n.nodeName!=="BODY");return[u,r+e.offsetWidth,u+e.offsetHeight,r]},p=function(){for(var u,f,i,r,t=0;t<n.length;++t){for(f=[],i=rt(n[t],"position"),i!=="fixed"&&(i=rt(n[t].parentNode,"position")),u=n[t].rows.length-1;u>=0;--u)n[t].rows[u].style.display!=="none"&&(f[u]=tt(n[t].rows[u],i));n[t].redips.offset=tt(n[t],i);n[t].redips.row_offset=f}for(it=tt(k),t=0;t<e.container.length;++t)i=rt(e.container[t].div,"position"),r=tt(e.container[t].div,i,!1),e.container[t].offset=r,e.container[t].midstX=(r[1]+r[3])/2,e.container[t].midstY=(r[0]+r[2])/2},et=function(){var n,t;return typeof pageYOffset=="number"?(n=window.pageXOffset,t=window.pageYOffset):document.body&&(document.body.scrollLeft||document.body.scrollTop)?(n=document.body.scrollLeft,t=document.body.scrollTop):document.documentElement&&(document.documentElement.scrollLeft||document.documentElement.scrollTop)?(n=document.documentElement.scrollLeft,t=document.documentElement.scrollTop):n=t=0,[n,t]},ui=function(n){var f,a,u,o,i,c=nt.x,l=nt.y;r.flag.x>0&&(p(),ot(),c<it[1]&&c>it[3]&&l<it[2]&&l>it[0]&&ri());typeof n=="object"&&(e.obj=n);e.obj===window?(u=a=et()[0],o=e.width-h.width,i=r.page.x):(u=e.obj.scrollLeft,o=e.obj.scrollWidth-e.obj.clientWidth,i=r.div.x);r.flag.x>0&&(i<0&&u>0||i>0&&u<o)?(e.obj===window?(window.scrollBy(i,0),u=et()[0],f=parseInt(t.style.left,10),isNaN(f)&&(f=0)):e.obj.scrollLeft+=i,setTimeout(ui,REDIPS.drag.scroll.speed)):(REDIPS.event.add(e.obj,"scroll",p),r.flag.x=0,s=[0,0,0,0])},fi=function(n){var f,a,u,o,i,c=nt.x,l=nt.y;r.flag.y>0&&(p(),ot(),c<it[1]&&c>it[3]&&l<it[2]&&l>it[0]&&ri());typeof n=="object"&&(e.obj=n);e.obj===window?(u=a=et()[1],o=e.height-h.height,i=r.page.y):(u=e.obj.scrollTop,o=e.obj.scrollHeight-e.obj.clientHeight,i=r.div.y);r.flag.y>0&&(i<0&&u>0||i>0&&u<o)?(e.obj===window?(window.scrollBy(0,i),u=et()[1],f=parseInt(t.style.top,10),isNaN(f)&&(f=0)):e.obj.scrollTop+=i,setTimeout(fi,REDIPS.drag.scroll.speed)):(REDIPS.event.add(e.obj,"scroll",p),r.flag.y=0,s=[0,0,0,0])},ei=function(n,t){var i=n.cloneNode(!0),r=i.className,u,f;return t===!0&&(document.getElementById("redips_clone").appendChild(i),i.style.zIndex=999,i.style.position="fixed",u=tt(n),f=tt(i),i.style.top=u[0]-f[0]+"px",i.style.left=u[3]-f[3]+"px"),i.setCapture&&i.setCapture(),r=r.replace("clone",""),r=r.replace(/climit(\d)_(\d+)/,""),i.className=ai(r),lt[n.id]===undefined&&(lt[n.id]=0),i.id=n.id+"c"+lt[n.id],lt[n.id]+=1,tr(n,i),i},tr=function(n,t){var i=[],r;i[0]=function(n,t){n.redips&&(t.redips={},t.redips.enabled=n.redips.enabled,t.redips.container=n.redips.container,n.redips.enabled&&ct(t))};i[1]=function(n,t){n.redips&&(t.redips={},t.redips.emptyRow=n.redips.emptyRow)};r=function(r){var e,f,o=["DIV","TR"],u;for(e=n.getElementsByTagName(o[r]),f=t.getElementsByTagName(o[r]),u=0;u<f.length;++u)i[r](e[u],f[u])};n.nodeName==="DIV"?i[0](n,t):n.nodeName==="TR"&&i[1](n,t);r(0);r(1)},oi=function(n,t){var u,f,r,i;i=n.className;u=i.match(/climit(\d)_(\d+)/);u!==null&&(f=parseInt(u[1],10),r=parseInt(u[2],10),r===0&&t===1&&(i+=" clone",f===2&&wt(!0,n)),r+=t,i=i.replace(/climit\d_\d+/g,"climit"+f+"_"+r),r<=0&&(i=i.replace("clone",""),f===2?(wt(!1,n),REDIPS.drag.event.clonedEnd2()):REDIPS.drag.event.clonedEnd1()),n.className=ai(i))},ir=function(n){var t=!1,i,r;n.srcElement?(i=n.srcElement.nodeName,r=n.srcElement.className):(i=n.target.nodeName,r=n.target.className);switch(i){case"A":case"INPUT":case"SELECT":case"OPTION":case"TEXTAREA":t=!0;break;default:t=/\bnodrag\b/i.test(r)?!0:!1}return t},wt=function(n,t){var i=[],c=[],l,f,a,v,y,o,u,w,r,s,h;for(f=REDIPS.drag.style.opacityDisabled,n===!0||n==="init"?(l=REDIPS.drag.style.borderEnabled,a="move",o=!0):(l=REDIPS.drag.style.borderDisabled,a="auto",o=!1),t===undefined?i=k.getElementsByTagName("div"):typeof t=="string"?i=document.querySelectorAll(t):typeof t=="object"&&(t.nodeName!=="DIV"||t.className.indexOf("drag")===-1)?i=t.getElementsByTagName("div"):i[0]=t,r=0,s=0;r<i.length;++r)if(/\bdrag\b/i.test(i[r].className))n==="init"||i[r].redips===undefined?(i[r].redips={},i[r].redips.container=k):n===!0&&typeof f=="number"?(i[r].style.opacity="",i[r].style.filter=""):n===!1&&typeof f=="number"&&(i[r].style.opacity=f/100,i[r].style.filter="alpha(opacity="+f+")"),ct(i[r],o),i[r].redips.enabled=o;else if(n==="init"&&(v=rt(i[r],"overflow"),v!=="visible")){for(REDIPS.event.add(i[r],"scroll",p),w=rt(i[r],"position"),u=tt(i[r],w,!1),y=/\bnoautoscroll\b/i.test(i[r].className)?!1:!0,e.container[s]={div:i[r],offset:u,midstX:(u[1]+u[3])/2,midstY:(u[0]+u[2])/2,autoscroll:y},c=i[r].getElementsByTagName("table"),h=0;h<c.length;++h)c[h].sca=e.container[s];++s}},pr=function(n){var t;typeof n=="object"&&n.nodeName==="DIV"?n.parentNode.removeChild(n):typeof n=="string"&&(t=document.getElementById(n),t&&t.parentNode.removeChild(t))},sr=function(t,i){if(typeof i=="object"&&i.nodeName==="TABLE")i.redips.enabled=t;else for(var r=0;r<n.length;++r)n[r].className.indexOf(i)>-1&&(n[r].redips.enabled=t)},rt=function(n,t){var i;return n&&n.currentStyle?i=n.currentStyle[t]:n&&window.getComputedStyle&&(i=document.defaultView.getComputedStyle(n,null)[t]),i},b=function(n,t,i){for(t=t.parentNode,i===undefined&&(i=0);t&&t.nodeName!==n;)t=t.parentNode,t&&t.nodeName===n&&i>0&&(--i,t=t.parentNode);return t},rr=function(n,t){var u=b("TABLE",t),i,r,f;switch(n){case"firstInColumn":i=0;r=t.cellIndex;break;case"firstInRow":i=t.parentNode.rowIndex;r=0;break;case"lastInColumn":i=u.rows.length-1;r=t.cellIndex;break;case"lastInRow":i=t.parentNode.rowIndex;r=u.rows[i].cells.length-1;break;case"last":i=u.rows.length-1;r=u.rows[i].cells.length-1;break;default:i=r=0}return f=u.rows[i].cells[r],[i,r,f]},lr=function(n,t){var u="",h,c,e,f,s=[],l=REDIPS.drag.saveParamName,i,r,o;if(typeof n=="string"&&(n=document.getElementById(n)),n!==undefined&&typeof n=="object"&&n.nodeName==="TABLE"){for(h=n.rows.length,i=0;i<h;++i)for(c=n.rows[i].cells.length,r=0;r<c;++r)if(e=n.rows[i].cells[r],e.childNodes.length>0)for(o=0;o<e.childNodes.length;++o)f=e.childNodes[o],f.nodeName==="DIV"&&f.className.indexOf("drag")>-1&&(u+=l+"[]="+f.id+"_"+i+"_"+r+"&",s.push([f.id,i,r]));u=t==="json"&&s.length>0?JSON.stringify(s):u.substring(0,u.length-1)}return u},ni=function(n,t,i){var o,s,e,u,h,r,f;if((h=function(n,t){REDIPS.drag.event.relocateBefore(n,t);var i=REDIPS.drag.getPosition(t);REDIPS.drag.moveObject({obj:n,target:i,callback:function(n){var i=REDIPS.drag.findParent("TABLE",n),r=i.redips.idx;REDIPS.drag.event.relocateAfter(n,t);--yi[r];yi[r]===0&&(REDIPS.drag.event.relocateEnd(),REDIPS.drag.enableTable(!0,i))}})},n!==t)&&typeof n=="object"&&typeof t=="object")if(e=n.childNodes.length,i==="animation"){if(e>0)for(o=b("TABLE",t),s=o.redips.idx,REDIPS.drag.enableTable(!1,o),r=0;r<e;++r)n.childNodes[r].nodeType===1&&n.childNodes[r].nodeName==="DIV"&&(++yi[s],h(n.childNodes[r],t))}else for(r=0,f=0;r<e;++r)n.childNodes[f].nodeType===1&&n.childNodes[f].nodeName==="DIV"?(u=n.childNodes[f],REDIPS.drag.event.relocateBefore(u,t),t.appendChild(u),u.redips&&u.redips.enabled!==!1&&ct(u),REDIPS.drag.event.relocateAfter(u)):++f},ti=function(n,t){var r,u=[],i;if(n.nodeName==="TD"){if(r=n.childNodes.length,t==="test")return f.source===n?undefined:n.childNodes.length===0||n.childNodes.length===1&&n.firstChild.nodeType===3?!0:!1;for(i=0;i<r;++i)u.push(n.childNodes[0]),n.removeChild(n.childNodes[0]);return u}},si=function(n,t){var l,r,i,h,e,it,rt,a,v,u,o,c,y,ft,p,w,k,s,d,g,nt=!1,tt,ut;if(tt=function(n,t){REDIPS.drag.shift.animation?ni(n,t,"animation"):ni(n,t)},ut=function(n){REDIPS.drag.shift.overflow==="delete"?ti(n):REDIPS.drag.shift.overflow==="source"?tt(n,f.source):typeof REDIPS.drag.shift.overflow=="object"&&tt(n,REDIPS.drag.shift.overflow);nt=!1;REDIPS.drag.event.shiftOverflow(n)},n!==t){p=REDIPS.drag.shift.mode;l=b("TABLE",n);r=b("TABLE",t);rt=ar(r);h=l===r?[n.redips.rowIndex,n.redips.cellIndex]:[-1,-1];e=[t.redips.rowIndex,t.redips.cellIndex];w=r.rows.length;k=vr(r);switch(p){case"vertical2":i=l===r&&n.redips.cellIndex===t.redips.cellIndex?h:[w,t.redips.cellIndex];break;case"horizontal2":i=l===r&&n.parentNode.rowIndex===t.parentNode.rowIndex?h:[t.redips.rowIndex,k];break;default:i=l===r?h:[w,k]}for(p==="vertical1"||p==="vertical2"?(it=i[1]*1e3+i[0]<e[1]*1e3+e[0]?1:-1,g=w,s=0,d=1):(it=i[0]*1e3+i[1]<e[0]*1e3+e[1]?1:-1,g=k,s=1,d=0),i[0]!==h[0]&&i[1]!==h[1]&&(nt=!0);i[0]!==e[0]||i[1]!==e[1];)if(v=rt[i[0]+"-"+i[1]],i[s]+=it,i[s]<0?(i[s]=g,--i[d]):i[s]>g&&(i[s]=0,++i[d]),a=rt[i[0]+"-"+i[1]],a!==undefined&&(u=a),v!==undefined&&(o=v),a!==undefined&&o!==undefined||u!==undefined&&v!==undefined){if(c=u.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,y=o.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,nt&&c===0&&y===1&&ut(u),c===1){y===0&&(ft=o);continue}else c===0&&y===1&&(o=ft);tt(u,o)}else nt&&u!==undefined&&o===undefined&&(c=u.className.indexOf(REDIPS.drag.mark.cname)===-1?0:1,c===0&&ut(u))}},ar=function(n){for(var u=[],c,l={},i,r,a,v,f,s,t,h,o=n.rows,e=0;e<o.length;++e)for(s=0;s<o[e].cells.length;++s){for(i=o[e].cells[s],r=i.parentNode.rowIndex,a=i.rowSpan||1,v=i.colSpan||1,u[r]=u[r]||[],t=0;t<u[r].length+1;++t)if(typeof u[r][t]=="undefined"){f=t;break}for(l[r+"-"+f]=i,i.redips===undefined&&(i.redips={}),i.redips.rowIndex=r,i.redips.cellIndex=f,t=r;t<r+a;++t)for(u[t]=u[t]||[],c=u[t],h=f;h<f+v;++h)c[h]="x"}return l},vr=function(n){var u=n.rows,i,f=0,t,r;for(typeof n=="string"&&(n=document.getElementById(n)),t=0;t<u.length;++t){for(i=0,r=0;r<u[t].cells.length;++r)i+=u[t].cells[r].colSpan||1;i>f&&(f=i)}return f},yr=function(t){var i={direction:1},f,e,p,w,o,s,v,y,h,d,l,a,r,u;if(i.callback=t.callback,i.overwrite=t.overwrite,typeof t.id=="string"?i.obj=i.objOld=document.getElementById(t.id):typeof t.obj=="object"&&t.obj.nodeName==="DIV"&&(i.obj=i.objOld=t.obj),t.mode==="row"){if(i.mode="row",u=hi(t.source[0]),h=t.source[1],c=i.objOld=n[u].rows[h],c.redips&&c.redips.emptyRow===!0)return!1;i.obj=ii(i.objOld,"animated")}else if(i.obj&&i.obj.className.indexOf("row")>-1){if(i.mode="row",i.obj=i.objOld=c=b("TR",i.obj),c.redips&&c.redips.emptyRow===!0)return!1;i.obj=ii(i.objOld,"animated")}else i.mode="cell";if(typeof i.obj=="object"&&i.obj!==null)return i.obj.style.zIndex=999,i.obj.redips&&k!==i.obj.redips.container&&(k=i.obj.redips.container,ht()),r=tt(i.obj),p=r[1]-r[3],w=r[2]-r[0],f=r[3],e=r[0],t.clone===!0&&i.mode==="cell"&&(i.obj=ei(i.obj,!0),REDIPS.drag.event.cloned(i.obj)),t.target===undefined?t.target=ci():typeof t.target=="object"&&t.target.nodeName==="TD"&&(t.target=ci(t.target)),i.target=t.target,u=hi(t.target[0]),h=t.target[1],d=t.target[2],h>n[u].rows.length-1&&(h=n[u].rows.length-1),i.targetCell=n[u].rows[h].cells[d],i.mode==="cell"?(r=tt(i.targetCell),v=r[1]-r[3],y=r[2]-r[0],o=r[3]+(v-p)/2,s=r[0]+(y-w)/2):(r=tt(n[u].rows[h]),v=r[1]-r[3],y=r[2]-r[0],o=r[3],s=r[0]),l=o-f,a=s-e,i.obj.style.width=i.obj.offsetWidth+"px",i.obj.style.height=i.obj.offsetHeight+"px",i.obj.style.position="fixed",Math.abs(l)>Math.abs(a)?(i.type="horizontal",i.m=a/l,i.b=e-i.m*f,i.k1=(f+o)/(f-o),i.k2=2/(f-o),f>o&&(i.direction=-1),u=f,i.last=o):(i.type="vertical",i.m=l/a,i.b=f-i.m*e,i.k1=(e+s)/(e-s),i.k2=2/(e-s),e>s&&(i.direction=-1),u=e,i.last=s),i.obj.redips&&(i.obj.redips.animated=!0),ur(u,i),[i.obj,i.objOld]},ur=function(n,t){var r=(t.k1-t.k2*n)*(t.k1-t.k2*n),i;n=n+REDIPS.drag.animation.step*(4-r*3)*t.direction;i=t.m*n+t.b;t.type==="horizontal"?(t.obj.style.left=n+"px",t.obj.style.top=i+"px"):(t.obj.style.left=i+"px",t.obj.style.top=n+"px");n<t.last&&t.direction>0||n>t.last&&t.direction<0?setTimeout(function(){ur(n,t)},REDIPS.drag.animation.pause*r):(di(t.obj),t.obj.redips&&(t.obj.redips.animated=!1),t.mode==="cell"?(t.overwrite===!0&&ti(t.targetCell),t.targetCell.appendChild(t.obj),t.obj.redips&&t.obj.redips.enabled!==!1&&ct(t.obj)):fr(hi(t.target[0]),t.target[1],t.obj),typeof t.callback=="function"&&t.callback(t.obj))},ci=function(t){var c,l,f,e,s,r,a,h=[];return f=e=s=-1,t===undefined?(c=i<n.length?n[i].redips.idx:y===null||w===null||g===null?n[d].redips.idx:n[y].redips.idx,l=n[d].redips.idx,h=[c,u,o,l,ft,st]):(r=typeof t=="string"?document.getElementById(t):t,r&&(r.nodeName!=="TD"&&(r=b("TD",r)),r&&r.nodeName==="TD"&&(f=r.cellIndex,e=r.parentNode.rowIndex,a=b("TABLE",r),s=a.redips.idx)),h=[s,e,f]),h},hi=function(t){for(var i=0;i<n.length;++i)if(n[i].redips.idx===t)break;return i},ai=function(n){return n!==undefined&&(n=n.replace(/^\s+|\s+$/g,"").replace(/\s{2,}/g," ")),n},kr=function(n){for(var t=0;t<n.childNodes.length;++t)if(n.childNodes[t].nodeType===1)return!0;return!1},li=function(n,t,i){var u,r,f;if(typeof n=="string"&&(n=document.getElementById(n),n=b("TABLE",n)),n.nodeName==="TR")for(u=n.getElementsByTagName("td"),r=0;r<u.length;++r)if(u[r].style.backgroundColor=i?i:"",t==="empty")u[r].innerHTML="";else for(f=0;f<u[r].childNodes.length;++f)u[r].childNodes[f].nodeType===1&&(u[r].childNodes[f].style.opacity=t/100,u[r].childNodes[f].style.filter="alpha(opacity="+t+")");else n.style.opacity=t/100,n.style.filter="alpha(opacity="+t+")",n.style.backgroundColor=i?i:""},wr=function(n,t,i){var u=document.getElementById(n),r=u.rows[t];i===undefined&&(i=REDIPS.drag.style.rowEmptyColor);r.redips===undefined&&(r.redips={});r.redips.emptyRow=!0;li(r,"empty",i)},{obj:t,objOld:c,mode:v,td:f,hover:{colorTd:"#83bfe7",colorTr:"#83bfe7"},scroll:{enable:!0,bound:25,speed:20},only:pi,mark:dr,style:{borderEnabled:"solid",borderDisabled:"solid",opacityDisabled:"",rowEmptyColor:"#fff"},trash:{className:"trash",question:null,questionRow:null},saveParamName:"p",dropMode:"multiple",multipleDrop:"bottom",clone:gr,animation:{pause:20,step:2,shift:!1},shift:{mode:"horizontal1",after:"default",overflow:"bunch"},rowDropMode:"before",tableSort:!0,init:or,initTables:ht,enableDrag:wt,enableTable:sr,cloneObject:ei,saveContent:lr,relocate:ni,emptyCell:ti,moveObject:yr,shiftCells:si,deleteObject:pr,getPosition:ci,rowOpacity:li,rowEmpty:wr,getScrollPosition:et,getStyle:rt,findParent:b,findCell:rr,event:nu}}();REDIPS.event||(REDIPS.event=function(){var n,t;return n=function(n,t,i){n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent?n.attachEvent("on"+t,i):n["on"+t]=i},t=function(n,t,i){n.removeEventListener?n.removeEventListener(t,i,!1):n.detachEvent?n.detachEvent("on"+t,i):n["on"+t]=null},{add:n,remove:t}}());g_boardm=new BonusesLayout;g_bui=new RedipsUI;const DEBUG=!1;var g_boardwidth=15,g_boardheight=15,g_racksize=8,g_animation=0,g_wait=500,g_board,g_boardpoints,g_boardmults,g_letpool=[],g_letscore={},g_matches_cache={},g_pscore=0,g_oscore=0,g_board_empty=!0,g_passes=0,g_maxpasses=2,g_lmults=[1,2,3,1,1],g_wmults=[1,1,1,2,3],g_opponent_has_joker,g_allLettersBonus=50,g_playlevel=g_bui.getPlayLevel(),g_maxwpoints=[10,20,30,40,50,75,100,125,250,500],g_wstr=[],g_def,g_cache,gCloneFunc=typeof Object.create=="function"?Object.create:function(n){var t={};for(var i in n)t[i]=n[i];return t};window.init=init;document.addEventListener("keydown",handleKeyDown);window.addEventListener("load",function(){if(g_cache={app:el("app"),modalMask:el("modal-mask"),modalContainer:el("modal-container"),modalInner:el("modal-inner"),modalContent:el("modal-content"),sound:el("sound")},Array.prototype.indexOf&&document.querySelector&&window.addEventListener&&window.console&&window.DOMTokenList&&window.JSON&&window.localStorage)init("board"),g_cache.modalMask.addEventListener("click",closeModal),g_cache.modalInner.addEventListener("click",handleHideModal);else{var n=["&#9785;","&#128530;","&#128546;","&#128528;","&#128527;","&#128529;","&#128532;","&#128533;","&#128542;","&#128543;","&#128550;","&#128551;"];g_cache.app.innerHTML="<p><strong>"+n[randInt(0,n.length-1)]+"</strong><br><br><br>"+t("Sorry, this browser is not supported. Please upgrade to a modern browser.")+"</p>";gtag("event",navigator.userAgent,{event_category:"Unsupported Browser"})}document.documentElement.classList.replace("loading","loaded")});